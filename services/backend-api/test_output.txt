=== RUN   TestAnalyticsService_CalculateCorrelationMatrix
--- PASS: TestAnalyticsService_CalculateCorrelationMatrix (0.00s)
=== RUN   TestAnalyticsService_DetectMarketRegime
--- PASS: TestAnalyticsService_DetectMarketRegime (0.00s)
=== RUN   TestAnalyticsService_ForecastSeries
--- PASS: TestAnalyticsService_ForecastSeries (0.00s)
=== RUN   TestArbitrageService_StoreMultiLegOpportunities
--- PASS: TestArbitrageService_StoreMultiLegOpportunities (0.00s)
=== RUN   TestArbitrageService_ConfigParsing
--- PASS: TestArbitrageService_ConfigParsing (0.00s)
=== RUN   TestArbitrageService_ContextManagement
--- PASS: TestArbitrageService_ContextManagement (0.01s)
=== RUN   TestArbitrageService_ConcurrentOperations
--- PASS: TestArbitrageService_ConcurrentOperations (0.00s)
=== RUN   TestArbitrageService_TimeHandling
--- PASS: TestArbitrageService_TimeHandling (0.00s)
=== RUN   TestArbitrageService_ErrorHandling
--- PASS: TestArbitrageService_ErrorHandling (0.00s)
=== RUN   TestArbitrageService_StateTransitions
--- PASS: TestArbitrageService_StateTransitions (0.00s)
=== RUN   TestArbitrageService_MetricsCollection
--- PASS: TestArbitrageService_MetricsCollection (0.00s)
=== RUN   TestArbitrageService_BatchProcessing
--- PASS: TestArbitrageService_BatchProcessing (0.00s)
=== RUN   TestNewArbitrageService
--- PASS: TestNewArbitrageService (0.00s)
=== RUN   TestNewArbitrageService_DefaultValues
--- PASS: TestNewArbitrageService_DefaultValues (0.00s)
=== RUN   TestArbitrageService_StartStop
{"level":"info","timestamp":"2025-12-24T08:43:23.812+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_StartStop (0.00s)
=== RUN   TestArbitrageService_StartDisabled
{"level":"info","timestamp":"2025-12-24T08:43:23.812+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_StartDisabled (0.00s)
=== RUN   TestArbitrageService_Start
=== RUN   TestArbitrageService_Start/disabled_config
{"level":"info","timestamp":"2025-12-24T08:43:23.812+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
=== RUN   TestArbitrageService_Start/enabled_config_minimal
{"level":"info","timestamp":"2025-12-24T08:43:23.812+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
=== RUN   TestArbitrageService_Start/enabled_with_custom_settings
{"level":"info","timestamp":"2025-12-24T08:43:23.813+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
=== RUN   TestArbitrageService_Start/default_config_values
{"level":"info","timestamp":"2025-12-24T08:43:23.813+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_Start (0.00s)
    --- PASS: TestArbitrageService_Start/disabled_config (0.00s)
    --- PASS: TestArbitrageService_Start/enabled_config_minimal (0.00s)
    --- PASS: TestArbitrageService_Start/enabled_with_custom_settings (0.00s)
    --- PASS: TestArbitrageService_Start/default_config_values (0.00s)
=== RUN   TestArbitrageService_Start_ContextHandling
{"level":"info","timestamp":"2025-12-24T08:43:23.813+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_Start_ContextHandling (0.01s)
=== RUN   TestArbitrageService_Start_GoroutineLaunch
{"level":"info","timestamp":"2025-12-24T08:43:23.824+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_Start_GoroutineLaunch (0.00s)
=== RUN   TestArbitrageService_Start_Logging
{"level":"info","timestamp":"2025-12-24T08:43:23.824+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_Start_Logging (0.05s)
=== RUN   TestArbitrageService_Start_MutexBehavior
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Arbitrage service is disabled in configuration"}
--- PASS: TestArbitrageService_Start_MutexBehavior (0.00s)
=== RUN   TestArbitrageService_GetStatus
--- PASS: TestArbitrageService_GetStatus (0.00s)
=== RUN   TestArbitrageService_ConcurrentAccess
--- PASS: TestArbitrageService_ConcurrentAccess (0.00s)
=== RUN   TestArbitrageService_ConfigValidation
=== RUN   TestArbitrageService_ConfigValidation/All_values_provided
=== RUN   TestArbitrageService_ConfigValidation/Only_enabled_flag
=== RUN   TestArbitrageService_ConfigValidation/Partial_configuration
--- PASS: TestArbitrageService_ConfigValidation (0.00s)
    --- PASS: TestArbitrageService_ConfigValidation/All_values_provided (0.00s)
    --- PASS: TestArbitrageService_ConfigValidation/Only_enabled_flag (0.00s)
    --- PASS: TestArbitrageService_ConfigValidation/Partial_configuration (0.00s)
=== RUN   TestArbitrageService_calculationLoop
=== RUN   TestArbitrageService_calculationLoop/context_cancellation
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func1.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:830"}
=== RUN   TestArbitrageService_calculationLoop/interval_configuration
=== RUN   TestArbitrageService_calculationLoop/interval_configuration/short_interval
{"level":"info","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.874+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func2.1.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:908"}
=== RUN   TestArbitrageService_calculationLoop/interval_configuration/long_interval
{"level":"info","timestamp":"2025-12-24T08:43:23.885+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.885+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.885+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func2.1.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:908"}
=== RUN   TestArbitrageService_calculationLoop/interval_configuration/disabled_arbitrage
{"level":"info","timestamp":"2025-12-24T08:43:23.897+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.897+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.897+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func2.1.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:908"}
=== RUN   TestArbitrageService_calculationLoop/error_handling
{"level":"info","timestamp":"2025-12-24T08:43:23.908+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.908+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.908+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func3.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:955"}
=== RUN   TestArbitrageService_calculationLoop/immediate_calculation
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestArbitrageService_calculationLoop.func4.1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service_test.go:1002"}
--- PASS: TestArbitrageService_calculationLoop (0.08s)
    --- PASS: TestArbitrageService_calculationLoop/context_cancellation (0.00s)
    --- PASS: TestArbitrageService_calculationLoop/interval_configuration (0.03s)
        --- PASS: TestArbitrageService_calculationLoop/interval_configuration/short_interval (0.01s)
        --- PASS: TestArbitrageService_calculationLoop/interval_configuration/long_interval (0.01s)
        --- PASS: TestArbitrageService_calculationLoop/interval_configuration/disabled_arbitrage (0.01s)
    --- PASS: TestArbitrageService_calculationLoop/error_handling (0.05s)
    --- PASS: TestArbitrageService_calculationLoop/immediate_calculation (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/nil_database_scenario
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_0
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_1
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_2
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/context_cancellation_scenario
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/edge_cases
=== RUN   TestArbitrageService_calculateAndStoreOpportunities/edge_cases/nil_database
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities (0.00s)
    --- PASS: TestArbitrageService_calculateAndStoreOpportunities/nil_database_scenario (0.00s)
    --- PASS: TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios (0.00s)
        --- PASS: TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_0 (0.00s)
        --- PASS: TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_1 (0.00s)
        --- PASS: TestArbitrageService_calculateAndStoreOpportunities/various_configuration_scenarios/config_2 (0.00s)
    --- PASS: TestArbitrageService_calculateAndStoreOpportunities/context_cancellation_scenario (0.00s)
    --- PASS: TestArbitrageService_calculateAndStoreOpportunities/edge_cases (0.00s)
        --- PASS: TestArbitrageService_calculateAndStoreOpportunities/edge_cases/nil_database (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_NoMarketData
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_NoMarketData (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_SuccessPath
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_SuccessPath (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_CleanupError
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_CleanupError (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_GetMarketDataError
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_GetMarketDataError (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_CalculateError
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_CalculateError (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_StoreError
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_StoreError (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_NoValidOpportunities
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage service","interval_seconds":60,"min_profit":0.5,"max_age_minutes":30,"batch_size":100}
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_NoValidOpportunities (0.00s)
=== RUN   TestArbitrageService_calculateAndStoreOpportunities_ContextCancellation
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"info","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage opportunity calculation"}
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
--- PASS: TestArbitrageService_calculateAndStoreOpportunities_ContextCancellation (0.00s)
{"level":"warn","timestamp":"2025-12-24T08:43:23.959+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup old opportunities","error":"database pool is not available"}
=== RUN   TestArbitrageService_getLatestMarketData
--- PASS: TestArbitrageService_getLatestMarketData (0.00s)
{"level":"error","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:221","msg":"Initial arbitrage calculation failed","error":"failed to get market data: database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ArbitrageService).calculationLoop\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/arbitrage_service.go:280"}
=== RUN   TestArbitrageService_getLatestMarketData_Context
--- PASS: TestArbitrageService_getLatestMarketData_Context (0.00s)
=== RUN   TestArbitrageService_getLatestMarketData_ConfigVariations
=== RUN   TestArbitrageService_getLatestMarketData_ConfigVariations/enabled_arbitrage
=== RUN   TestArbitrageService_getLatestMarketData_ConfigVariations/disabled_arbitrage
=== RUN   TestArbitrageService_getLatestMarketData_ConfigVariations/high_frequency_config
--- PASS: TestArbitrageService_getLatestMarketData_ConfigVariations (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ConfigVariations/enabled_arbitrage (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ConfigVariations/disabled_arbitrage (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ConfigVariations/high_frequency_config (0.00s)
=== RUN   TestArbitrageService_getLatestMarketData_ErrorScenarios
=== RUN   TestArbitrageService_getLatestMarketData_ErrorScenarios/call_0
=== RUN   TestArbitrageService_getLatestMarketData_ErrorScenarios/call_1
=== RUN   TestArbitrageService_getLatestMarketData_ErrorScenarios/call_2
--- PASS: TestArbitrageService_getLatestMarketData_ErrorScenarios (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ErrorScenarios/call_0 (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ErrorScenarios/call_1 (0.00s)
    --- PASS: TestArbitrageService_getLatestMarketData_ErrorScenarios/call_2 (0.00s)
=== RUN   TestArbitrageService_filterOpportunities
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Filtered opportunities","original":3,"filtered":1}
--- PASS: TestArbitrageService_filterOpportunities (0.00s)
=== RUN   TestArbitrageService_storeOpportunities
--- PASS: TestArbitrageService_storeOpportunities (0.00s)
=== RUN   TestArbitrageService_storeOpportunities_Empty
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"No opportunities to store"}
--- PASS: TestArbitrageService_storeOpportunities_Empty (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch
=== RUN   TestArbitrageService_storeOpportunityBatch/SingleOpportunityNilDB
=== RUN   TestArbitrageService_storeOpportunityBatch/EmptyBatch
=== RUN   TestArbitrageService_storeOpportunityBatch/MultipleOpportunities
=== RUN   TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes
=== RUN   TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_1
=== RUN   TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_10
=== RUN   TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_50
=== RUN   TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_100
=== RUN   TestArbitrageService_storeOpportunityBatch/MinimalOpportunity
=== RUN   TestArbitrageService_storeOpportunityBatch/EdgeCaseValues
--- PASS: TestArbitrageService_storeOpportunityBatch (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/SingleOpportunityNilDB (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/EmptyBatch (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/MultipleOpportunities (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes (0.00s)
        --- PASS: TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_1 (0.00s)
        --- PASS: TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_10 (0.00s)
        --- PASS: TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_50 (0.00s)
        --- PASS: TestArbitrageService_storeOpportunityBatch/DifferentBatchSizes/BatchSize_100 (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/MinimalOpportunity (0.00s)
    --- PASS: TestArbitrageService_storeOpportunityBatch/EdgeCaseValues (0.00s)
=== RUN   TestArbitrageService_cleanupOldOpportunities
--- PASS: TestArbitrageService_cleanupOldOpportunities (0.00s)
=== RUN   TestArbitrageService_countTotalTradingPairs
--- PASS: TestArbitrageService_countTotalTradingPairs (0.00s)
=== RUN   TestArbitrageService_GetActiveOpportunities
--- PASS: TestArbitrageService_GetActiveOpportunities (0.00s)
=== RUN   TestArbitrageService_GetActiveOpportunities_WithData
--- PASS: TestArbitrageService_GetActiveOpportunities_WithData (0.00s)
=== RUN   TestArbitrageService_Stop
=== RUN   TestArbitrageService_Stop/stop_when_not_running
=== RUN   TestArbitrageService_Stop/stop_when_running_disabled
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
=== RUN   TestArbitrageService_Stop/stop_with_nil_context
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
=== RUN   TestArbitrageService_Stop/stop_with_active_context
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
=== RUN   TestArbitrageService_Stop/stop_multiple_times
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
=== RUN   TestArbitrageService_Stop/stop_with_zero_wait_group
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
--- PASS: TestArbitrageService_Stop (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_when_not_running (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_when_running_disabled (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_with_nil_context (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_with_active_context (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_multiple_times (0.00s)
    --- PASS: TestArbitrageService_Stop/stop_with_zero_wait_group (0.00s)
=== RUN   TestArbitrageService_Stop_Concurrent
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
--- PASS: TestArbitrageService_Stop_Concurrent (0.00s)
=== RUN   TestArbitrageService_Stop_ContextCancellation
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Stopping arbitrage service"}
{"level":"info","timestamp":"2025-12-24T08:43:23.960+0700","caller":"logging/logger.go:203","msg":"Arbitrage service stopped"}
--- PASS: TestArbitrageService_Stop_ContextCancellation (0.00s)
=== RUN   TestArbitrageService_Stop_MutexBehavior
--- PASS: TestArbitrageService_Stop_MutexBehavior (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_Success
--- PASS: TestArbitrageService_storeOpportunityBatch_Success (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_EmptyBatch
--- PASS: TestArbitrageService_storeOpportunityBatch_EmptyBatch (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_BeginTransactionError
--- PASS: TestArbitrageService_storeOpportunityBatch_BeginTransactionError (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_InsertError
--- PASS: TestArbitrageService_storeOpportunityBatch_InsertError (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_CommitError
--- PASS: TestArbitrageService_storeOpportunityBatch_CommitError (0.00s)
=== RUN   TestArbitrageService_storeOpportunityBatch_EmptyID
--- PASS: TestArbitrageService_storeOpportunityBatch_EmptyID (0.00s)
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/empty_market_data
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/single_exchange_data_-_no_arbitrage
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_exchanges_with_profitable_arbitrage
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_exchanges_with_no_profitable_arbitrage
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_symbols_with_arbitrage_opportunities
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/three_exchanges_-_should_pick_best_arbitrage
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/zero_price_data
--- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/empty_market_data (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/single_exchange_data_-_no_arbitrage (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_exchanges_with_profitable_arbitrage (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_exchanges_with_no_profitable_arbitrage (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/multiple_symbols_with_arbitrage_opportunities (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/three_exchanges_-_should_pick_best_arbitrage (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities/zero_price_data (0.00s)
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_small_price_difference
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_large_price_difference
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/exact_threshold_boundary
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/same_prices
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data#01
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data#02
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_small_price_difference#01
=== RUN   TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_large_price_difference#01
--- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_small_price_difference (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_large_price_difference (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/exact_threshold_boundary (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/same_prices (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data#01 (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/nil_trading_pair_data#02 (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_small_price_difference#01 (0.00s)
    --- PASS: TestSpotArbitrageCalculator_CalculateArbitrageOpportunities_EdgeCases/very_large_price_difference#01 (0.00s)
=== RUN   TestNewBacktester
--- PASS: TestNewBacktester (0.00s)
=== RUN   TestDefaultBacktestConfig
--- PASS: TestDefaultBacktestConfig (0.00s)
=== RUN   TestValidateConfig
=== RUN   TestValidateConfig/empty_config
=== RUN   TestValidateConfig/missing_end_date
=== RUN   TestValidateConfig/start_after_end
=== RUN   TestValidateConfig/zero_initial_capital
=== RUN   TestValidateConfig/negative_initial_capital
=== RUN   TestValidateConfig/valid_config
--- PASS: TestValidateConfig (0.00s)
    --- PASS: TestValidateConfig/empty_config (0.00s)
    --- PASS: TestValidateConfig/missing_end_date (0.00s)
    --- PASS: TestValidateConfig/start_after_end (0.00s)
    --- PASS: TestValidateConfig/zero_initial_capital (0.00s)
    --- PASS: TestValidateConfig/negative_initial_capital (0.00s)
    --- PASS: TestValidateConfig/valid_config (0.00s)
=== RUN   TestCalculateMaxDrawdown
=== RUN   TestCalculateMaxDrawdown/empty_curve
=== RUN   TestCalculateMaxDrawdown/single_point
=== RUN   TestCalculateMaxDrawdown/no_drawdown_-_monotonic_increase
=== RUN   TestCalculateMaxDrawdown/10%_drawdown
=== RUN   TestCalculateMaxDrawdown/20%_drawdown
--- PASS: TestCalculateMaxDrawdown (0.00s)
    --- PASS: TestCalculateMaxDrawdown/empty_curve (0.00s)
    --- PASS: TestCalculateMaxDrawdown/single_point (0.00s)
    --- PASS: TestCalculateMaxDrawdown/no_drawdown_-_monotonic_increase (0.00s)
    --- PASS: TestCalculateMaxDrawdown/10%_drawdown (0.00s)
    --- PASS: TestCalculateMaxDrawdown/20%_drawdown (0.00s)
=== RUN   TestCalculateSharpeRatio
=== RUN   TestCalculateSharpeRatio/empty_returns
=== RUN   TestCalculateSharpeRatio/single_return
=== RUN   TestCalculateSharpeRatio/positive_consistent_returns
=== RUN   TestCalculateSharpeRatio/negative_consistent_returns
=== RUN   TestCalculateSharpeRatio/mixed_returns
--- PASS: TestCalculateSharpeRatio (0.00s)
    --- PASS: TestCalculateSharpeRatio/empty_returns (0.00s)
    --- PASS: TestCalculateSharpeRatio/single_return (0.00s)
    --- PASS: TestCalculateSharpeRatio/positive_consistent_returns (0.00s)
    --- PASS: TestCalculateSharpeRatio/negative_consistent_returns (0.00s)
    --- PASS: TestCalculateSharpeRatio/mixed_returns (0.00s)
=== RUN   TestCalculateSortinoRatio
=== RUN   TestCalculateSortinoRatio/all_positive_returns_-_high_sortino
=== RUN   TestCalculateSortinoRatio/mixed_with_some_negative
=== RUN   TestCalculateSortinoRatio/mostly_negative
--- PASS: TestCalculateSortinoRatio (0.00s)
    --- PASS: TestCalculateSortinoRatio/all_positive_returns_-_high_sortino (0.00s)
    --- PASS: TestCalculateSortinoRatio/mixed_with_some_negative (0.00s)
    --- PASS: TestCalculateSortinoRatio/mostly_negative (0.00s)
=== RUN   TestCalculatePositionSize
=== RUN   TestCalculatePositionSize/fixed_sizing
    backtester_test.go:350: Position size: 1000, Percentage: 10.00%
=== RUN   TestCalculatePositionSize/risk_adjusted_-_low_risk
    backtester_test.go:350: Position size: 1600, Percentage: 16.00%
=== RUN   TestCalculatePositionSize/risk_adjusted_-_high_risk
    backtester_test.go:350: Position size: 400, Percentage: 4.00%
=== RUN   TestCalculatePositionSize/kelly_sizing
    backtester_test.go:350: Position size: 1399.9999999999999, Percentage: 14.00%
--- PASS: TestCalculatePositionSize (0.00s)
    --- PASS: TestCalculatePositionSize/fixed_sizing (0.00s)
    --- PASS: TestCalculatePositionSize/risk_adjusted_-_low_risk (0.00s)
    --- PASS: TestCalculatePositionSize/risk_adjusted_-_high_risk (0.00s)
    --- PASS: TestCalculatePositionSize/kelly_sizing (0.00s)
=== RUN   TestCloseTrade
    backtester_test.go:396: Funding received: 4.1095890410976, Gross PnL: 4.1095890410976, Net PnL: -35.8904109589024
--- PASS: TestCloseTrade (0.00s)
=== RUN   TestGenerateDailyReturns
--- PASS: TestGenerateDailyReturns (0.00s)
=== RUN   TestBacktestResultCalculations
    backtester_test.go:510: Win rate: 66.66666666666667% (expected ~66.67%)
--- PASS: TestBacktestResultCalculations (0.00s)
=== RUN   TestCacheAnalyticsService_NewCacheAnalyticsService
--- PASS: TestCacheAnalyticsService_NewCacheAnalyticsService (0.00s)
=== RUN   TestCacheAnalyticsService_GetMetrics
=== RUN   TestCacheAnalyticsService_GetMetrics/WithRedisMock
--- PASS: TestCacheAnalyticsService_GetMetrics (0.00s)
    --- PASS: TestCacheAnalyticsService_GetMetrics/WithRedisMock (0.00s)
=== RUN   TestCacheAnalyticsService_GetMetrics_WithNilRedis
--- PASS: TestCacheAnalyticsService_GetMetrics_WithNilRedis (0.00s)
=== RUN   TestCacheAnalyticsService_reportStats_WithNilRedis
--- PASS: TestCacheAnalyticsService_reportStats_WithNilRedis (0.00s)
=== RUN   TestCacheAnalyticsService_GetMetrics_EmptyData
    cache_analytics_test.go:112: Skipping GetMetrics test due to miniredis INFO command limitations
--- SKIP: TestCacheAnalyticsService_GetMetrics_EmptyData (0.00s)
=== RUN   TestCacheAnalyticsService_GetMetrics_WithRedisInfo
    cache_analytics_test.go:136: Skipping GetMetrics test due to miniredis INFO command limitations
--- SKIP: TestCacheAnalyticsService_GetMetrics_WithRedisInfo (0.00s)
=== RUN   TestCacheAnalyticsService_ResetStats
--- PASS: TestCacheAnalyticsService_ResetStats (0.00s)
=== RUN   TestCacheAnalyticsService_RecordHit
--- PASS: TestCacheAnalyticsService_RecordHit (0.00s)
=== RUN   TestCacheAnalyticsService_RecordMiss
--- PASS: TestCacheAnalyticsService_RecordMiss (0.00s)
=== RUN   TestCacheAnalyticsService_GetStats
--- PASS: TestCacheAnalyticsService_GetStats (0.00s)
=== RUN   TestCacheAnalyticsService_GetAllStats
--- PASS: TestCacheAnalyticsService_GetAllStats (0.00s)
=== RUN   TestCacheAnalyticsService_parseRedisInfo
--- PASS: TestCacheAnalyticsService_parseRedisInfo (0.00s)
=== RUN   TestCacheAnalyticsService_parseRedisInfo_Comprehensive
--- PASS: TestCacheAnalyticsService_parseRedisInfo_Comprehensive (0.00s)
=== RUN   TestCacheAnalyticsService_StartPeriodicReporting
--- PASS: TestCacheAnalyticsService_StartPeriodicReporting (0.05s)
=== RUN   TestCacheWarmingService_NewCacheWarmingService
--- PASS: TestCacheWarmingService_NewCacheWarmingService (0.00s)
=== RUN   TestCacheWarmingService_WarmCache
2025/12/24 08:43:24 INFO Starting cache warming
2025/12/24 08:43:24 INFO Warming exchange configuration cache
2025/12/24 08:43:24 INFO Exchange configuration cache warmed successfully
2025/12/24 08:43:24 INFO Warming supported exchanges cache
2025/12/24 08:43:24 INFO Supported exchanges cache warmed successfully count=2
2025/12/24 08:43:24 INFO Warming trading pairs cache
2025/12/24 08:43:24 WARN Failed to warm trading pairs cache error="database is nil"
2025/12/24 08:43:24 INFO Warming exchanges cache
2025/12/24 08:43:24 WARN Failed to warm exchanges cache error="database is nil"
2025/12/24 08:43:24 INFO Warming funding rates cache
2025/12/24 08:43:24 WARN Failed to warm funding rates cache error="database is nil"
2025/12/24 08:43:24 INFO Cache warming completed duration_ms=0
--- PASS: TestCacheWarmingService_WarmCache (0.00s)
=== RUN   TestCacheWarmingService_warmExchangeConfig
2025/12/24 08:43:24 INFO Warming exchange configuration cache
2025/12/24 08:43:24 INFO Exchange configuration cache warmed successfully
--- PASS: TestCacheWarmingService_warmExchangeConfig (0.00s)
=== RUN   TestCacheWarmingService_warmSupportedExchanges
2025/12/24 08:43:24 INFO Warming supported exchanges cache
2025/12/24 08:43:24 INFO Supported exchanges cache warmed successfully count=2
--- PASS: TestCacheWarmingService_warmSupportedExchanges (0.00s)
=== RUN   TestCacheWarmingService_warmTradingPairs
2025/12/24 08:43:24 INFO Warming trading pairs cache
--- PASS: TestCacheWarmingService_warmTradingPairs (0.00s)
=== RUN   TestCacheWarmingService_warmExchanges
2025/12/24 08:43:24 INFO Warming exchanges cache
--- PASS: TestCacheWarmingService_warmExchanges (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_Success
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_Success (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_DatabaseError
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_DatabaseError (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_EmptyResults
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_EmptyResults (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_ScanError
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_ScanError (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_RedisError
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_RedisError (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_FullSuccess
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_FullSuccess (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_MultipleExchanges
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_MultipleExchanges (0.00s)
=== RUN   TestCacheWarmingService_warmFundingRates_TimePrecision
2025/12/24 08:43:24 INFO Warming funding rates cache
--- PASS: TestCacheWarmingService_warmFundingRates_TimePrecision (0.00s)
=== RUN   TestCacheWarmingService_errorHandling
2025/12/24 08:43:24 INFO Starting cache warming
2025/12/24 08:43:24 INFO Warming exchange configuration cache
2025/12/24 08:43:24 WARN Failed to warm exchange config cache error="ccxt service is nil"
2025/12/24 08:43:24 INFO Warming supported exchanges cache
2025/12/24 08:43:24 WARN Failed to warm supported exchanges cache error="ccxt service is nil"
2025/12/24 08:43:24 INFO Warming trading pairs cache
2025/12/24 08:43:24 WARN Failed to warm trading pairs cache error="database is nil"
2025/12/24 08:43:24 INFO Warming exchanges cache
2025/12/24 08:43:24 WARN Failed to warm exchanges cache error="database is nil"
2025/12/24 08:43:24 INFO Warming funding rates cache
2025/12/24 08:43:24 WARN Failed to warm funding rates cache error="database is nil"
2025/12/24 08:43:24 INFO Cache warming completed duration_ms=0
--- PASS: TestCacheWarmingService_errorHandling (0.00s)
=== RUN   TestCircuitBreaker_Basic
--- PASS: TestCircuitBreaker_Basic (0.00s)
=== RUN   TestCircuitBreaker_Execute
--- PASS: TestCircuitBreaker_Execute (0.00s)
=== RUN   TestCircuitBreaker_ExecuteWithError
{"level":"warn","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","circuit_breaker":"test-breaker","state":"closed","error":"test error","duration_ms":0,"failure_count":1}
--- PASS: TestCircuitBreaker_ExecuteWithError (0.00s)
=== RUN   TestCircuitBreaker_GetState
--- PASS: TestCircuitBreaker_GetState (0.00s)
=== RUN   TestCircuitBreaker_GetStats
--- PASS: TestCircuitBreaker_GetStats (0.00s)
=== RUN   TestCircuitBreaker_IsOpen
--- PASS: TestCircuitBreaker_IsOpen (0.00s)
=== RUN   TestCircuitBreaker_Reset
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"test-breaker"}
--- PASS: TestCircuitBreaker_Reset (0.00s)
=== RUN   TestCircuitBreaker_ConcurrentAccess
--- PASS: TestCircuitBreaker_ConcurrentAccess (0.00s)
=== RUN   TestCircuitBreaker_ConfigDefaults
--- PASS: TestCircuitBreaker_ConfigDefaults (0.00s)
=== RUN   TestCircuitBreaker_ContextCancellation
--- PASS: TestCircuitBreaker_ContextCancellation (0.00s)
=== RUN   TestCircuitBreaker_StateManagement
--- PASS: TestCircuitBreaker_StateManagement (0.00s)
=== RUN   TestCircuitBreaker_ErrorScenarios
{"level":"warn","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","circuit_breaker":"test-breaker","state":"closed","error":"callback error","duration_ms":0,"failure_count":1}
--- PASS: TestCircuitBreaker_ErrorScenarios (0.00s)
=== RUN   TestCircuitBreakerManager_GetAllStats_Empty
--- PASS: TestCircuitBreakerManager_GetAllStats_Empty (0.00s)
=== RUN   TestCircuitBreakerManager_GetAllStats_WithBreakers
--- PASS: TestCircuitBreakerManager_GetAllStats_WithBreakers (0.00s)
=== RUN   TestCircuitBreakerManager_GetAllStats_ConcurrentAccess
--- PASS: TestCircuitBreakerManager_GetAllStats_ConcurrentAccess (0.00s)
=== RUN   TestCircuitBreakerManager_ResetAll_Empty
--- PASS: TestCircuitBreakerManager_ResetAll_Empty (0.00s)
=== RUN   TestCircuitBreakerManager_ResetAll_WithBreakers
{"level":"warn","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","failure_count":1,"circuit_breaker":"breaker1","state":"closed","error":"test error","duration_ms":0}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","failure_count":2,"circuit_breaker":"breaker1","old_state":"closed","new_state":"open"}
{"level":"warn","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","duration_ms":0,"failure_count":2,"circuit_breaker":"breaker1","state":"open","error":"test error"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","new_state":"closed","failure_count":2,"circuit_breaker":"breaker1","old_state":"open"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker2"}
--- PASS: TestCircuitBreakerManager_ResetAll_WithBreakers (0.00s)
=== RUN   TestCircuitBreakerManager_ResetAll_ConcurrentAccess
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-2"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-3"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-4"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-5"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-6"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-7"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-4"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-5"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-6"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-2"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-3"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-7"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-9"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-4"}
{"level":"info","timestamp":"2025-12-24T08:43:24.019+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-0"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-5"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-8"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-6"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-2"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-7"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-3"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-9"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-9"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-4"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-0"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-5"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-6"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-7"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-9"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-0"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-4"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-5"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-6"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-7"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-9"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-0"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-8"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-0"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-8"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-2"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-8"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-3"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-2"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-3"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-1"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"breaker-8"}
--- PASS: TestCircuitBreakerManager_ResetAll_ConcurrentAccess (0.00s)
=== RUN   TestCircuitBreakerManager_GetAllStats_AfterReset
{"level":"warn","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","state":"closed","error":"test error","duration_ms":0,"failure_count":1,"circuit_breaker":"test-breaker"}
{"level":"warn","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","duration_ms":0,"failure_count":1,"circuit_breaker":"test-breaker","state":"closed","error":"test error"}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker manually reset","circuit_breaker":"test-breaker"}
--- PASS: TestCircuitBreakerManager_GetAllStats_AfterReset (0.00s)
=== RUN   TestCircuitBreaker_canExecute_ClosedState
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","circuit_breaker":"test-breaker","old_state":"closed","new_state":"open","failure_count":3}
--- PASS: TestCircuitBreaker_canExecute_ClosedState (0.00s)
=== RUN   TestCircuitBreaker_canExecute_OpenState
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","circuit_breaker":"test-breaker","old_state":"closed","new_state":"open","failure_count":0}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","circuit_breaker":"test-breaker","old_state":"open","new_state":"half-open","failure_count":0}
--- PASS: TestCircuitBreaker_canExecute_OpenState (0.00s)
=== RUN   TestCircuitBreaker_canExecute_HalfOpenState
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","circuit_breaker":"test-breaker","old_state":"closed","new_state":"half-open","failure_count":0}
--- PASS: TestCircuitBreaker_canExecute_HalfOpenState (0.00s)
=== RUN   TestCircuitBreaker_canExecute_ResetTimeout
--- PASS: TestCircuitBreaker_canExecute_ResetTimeout (0.00s)
=== RUN   TestCircuitBreaker_canExecute_UnknownState
--- PASS: TestCircuitBreaker_canExecute_UnknownState (0.00s)
=== RUN   TestCircuitBreaker_canExecute_StateTransitions
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","circuit_breaker":"test-breaker","old_state":"closed","new_state":"open","failure_count":0}
{"level":"info","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:203","msg":"Circuit breaker state changed","failure_count":0,"circuit_breaker":"test-breaker","old_state":"open","new_state":"half-open"}
--- PASS: TestCircuitBreaker_canExecute_StateTransitions (0.00s)
=== RUN   TestCircuitBreaker_canExecute_ConcurrentAccess
--- PASS: TestCircuitBreaker_canExecute_ConcurrentAccess (0.00s)
=== RUN   TestNewCleanupService
--- PASS: TestNewCleanupService (0.00s)
=== RUN   TestCleanupService_Start
2025/12/24 08:43:24 INFO Starting cleanup service with smart cleanup market_data_retention_hours=36 market_data_deletion_hours=12
2025/12/24 08:43:24 INFO Starting cleanup process smart_cleanup=true
{"level":"warn","timestamp":"2025-12-24T08:43:24.020+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_stats_before","attempt":1,"error":"database pool is not available","delay":0.1}
2025/12/24 08:43:24 INFO Stopping cleanup service
--- PASS: TestCleanupService_Start (0.02s)
=== RUN   TestCleanupService_RunCleanup
2025/12/24 08:43:24 INFO Starting cleanup process smart_cleanup=true
{"level":"warn","timestamp":"2025-12-24T08:43:24.042+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"database pool is not available","delay":0.1,"operation":"get_stats_before","attempt":1}
2025/12/24 08:43:24 WARN Failed to get data statistics before cleanup error="context canceled"
2025/12/24 08:43:24 INFO Using smart cleanup strategy market_data_retention_hours=36 market_data_deletion_hours=12 funding_rates_retention_hours=36 funding_rates_deletion_hours=12
{"level":"warn","timestamp":"2025-12-24T08:43:24.130+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"initial_cleanup","attempt":1,"error":"failed to cleanup market data: context canceled","delay":0.1}
{"level":"warn","timestamp":"2025-12-24T08:43:24.153+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_stats_before","attempt":2,"error":"database pool is not available","delay":0.2}
2025/12/24 08:43:24 ERROR Initial cleanup failed error="context canceled"
{"level":"warn","timestamp":"2025-12-24T08:43:24.324+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_stats_before","attempt":3,"error":"database pool is not available","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:24.639+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"get_stats_before","attempts":4,"duration":0.597415417,"error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CleanupService).runCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup.go:181\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CleanupService).RunCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup.go:163\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCleanupService_RunCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup_test.go:130\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
2025/12/24 08:43:24 WARN Failed to get data statistics before cleanup error="database pool is not available"
2025/12/24 08:43:24 INFO Using smart cleanup strategy market_data_retention_hours=36 market_data_deletion_hours=12 funding_rates_retention_hours=36 funding_rates_deletion_hours=12
{"level":"warn","timestamp":"2025-12-24T08:43:24.640+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"cleanup_market_data_smart","attempt":1,"error":"database pool is not available","delay":0.1}
{"level":"warn","timestamp":"2025-12-24T08:43:24.755+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","delay":0.2,"operation":"cleanup_market_data_smart","attempt":2,"error":"database pool is not available"}
{"level":"warn","timestamp":"2025-12-24T08:43:25.000+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"cleanup_market_data_smart","attempt":3,"error":"database pool is not available","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:25.381+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"cleanup_market_data_smart","attempts":4,"duration":0.741649459,"error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CleanupService).runCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup.go:206\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CleanupService).RunCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup.go:163\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCleanupService_RunCleanup\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/cleanup_test.go:130\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestCleanupService_RunCleanup (1.34s)
=== RUN   TestCleanupService_GetDataStats
--- PASS: TestCleanupService_GetDataStats (0.00s)
=== RUN   TestCleanupService_GetDataStats_WithError
--- PASS: TestCleanupService_GetDataStats_WithError (0.00s)
=== RUN   TestCleanupService_CleanupMarketDataSmart
--- PASS: TestCleanupService_CleanupMarketDataSmart (0.00s)
=== RUN   TestCleanupService_CleanupFundingRatesSmart
--- PASS: TestCleanupService_CleanupFundingRatesSmart (0.00s)
=== RUN   TestCleanupService_CleanupArbitrageOpportunities
--- PASS: TestCleanupService_CleanupArbitrageOpportunities (0.00s)
=== RUN   TestCleanupService_CleanupFundingArbitrageOpportunities
--- PASS: TestCleanupService_CleanupFundingArbitrageOpportunities (0.00s)
=== RUN   TestCleanupService_CleanupMarketData
--- PASS: TestCleanupService_CleanupMarketData (0.00s)
=== RUN   TestCleanupService_CleanupFundingRates
--- PASS: TestCleanupService_CleanupFundingRates (0.00s)
=== RUN   TestCleanupService_CleanupMarketData_WithRealDatabase
2025/12/24 08:43:25 INFO Smart cleanup: Removed market data records records_deleted=5 retention_hours=36 buffer_hours=24
--- PASS: TestCleanupService_CleanupMarketData_WithRealDatabase (0.00s)
=== RUN   TestCleanupService_CleanupFundingRates_WithRealDatabase
2025/12/24 08:43:25 INFO Smart cleanup: Removed funding rate records records_deleted=3 retention_hours=36 buffer_hours=24
--- PASS: TestCleanupService_CleanupFundingRates_WithRealDatabase (0.00s)
=== RUN   TestCleanupService_CleanupMarketData_ContextCancellation
--- PASS: TestCleanupService_CleanupMarketData_ContextCancellation (0.00s)
=== RUN   TestCleanupService_CleanupFundingRates_ContextCancellation
--- PASS: TestCleanupService_CleanupFundingRates_ContextCancellation (0.00s)
=== RUN   TestCleanupService_CleanupMarketData_NegativeRetention
--- PASS: TestCleanupService_CleanupMarketData_NegativeRetention (0.00s)
=== RUN   TestCleanupService_CleanupFundingRates_ZeroRetention
--- PASS: TestCleanupService_CleanupFundingRates_ZeroRetention (0.00s)
=== RUN   TestCleanupService_CleanupMarketDataSmart_WithError
--- PASS: TestCleanupService_CleanupMarketDataSmart_WithError (0.00s)
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/NilDatabase
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/SuccessfulDeletion
2025/12/24 08:43:25 INFO Smart cleanup: Removed market data records records_deleted=10 retention_hours=36 buffer_hours=24
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/NoRowsDeleted
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/DatabaseError
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/DifferentHours
2025/12/24 08:43:25 INFO Smart cleanup: Removed market data records records_deleted=25 retention_hours=48 buffer_hours=24
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/ZeroRetentionHours
2025/12/24 08:43:25 INFO Smart cleanup: Removed market data records records_deleted=100 retention_hours=0 buffer_hours=0
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/NegativeRetentionHours
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/CancelledContext
=== RUN   TestCleanupService_CleanupMarketDataSmart_Comprehensive/TimeCalculation
2025/12/24 08:43:25 INFO Smart cleanup: Removed market data records records_deleted=5 retention_hours=24 buffer_hours=12
--- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/NilDatabase (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/SuccessfulDeletion (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/NoRowsDeleted (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/DatabaseError (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/DifferentHours (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/ZeroRetentionHours (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/NegativeRetentionHours (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/CancelledContext (0.00s)
    --- PASS: TestCleanupService_CleanupMarketDataSmart_Comprehensive/TimeCalculation (0.00s)
=== RUN   TestCleanupService_Stop
2025/12/24 08:43:25 INFO Stopping cleanup service
--- PASS: TestCleanupService_Stop (0.00s)
=== RUN   TestCleanupService_ContextCancellation
2025/12/24 08:43:25 INFO Starting cleanup service with smart cleanup market_data_retention_hours=36 market_data_deletion_hours=12
2025/12/24 08:43:25 INFO Starting cleanup process smart_cleanup=true
{"level":"warn","timestamp":"2025-12-24T08:43:25.382+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_stats_before","attempt":1,"error":"database pool is not available","delay":0.1}
2025/12/24 08:43:25 INFO Stopping cleanup service
--- PASS: TestCleanupService_ContextCancellation (0.02s)
=== RUN   TestNewCollectorService
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.403+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestNewCollectorService (0.00s)
=== RUN   TestCollectorService_Start
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.403+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:25.403+0700","caller":"logging/logger.go:203","msg":"Starting market data collector service..."}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:201","msg":"Market data collector service started%!(EXTRA string=workers_initializing, bool=true)"}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:203","msg":"Starting background symbol collection and worker initialization..."}
{"level":"warn","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:212","msg":"Database not available, returning all exchanges"}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:203","msg":"Collecting symbols from exchanges concurrently","exchange_count":0,"max_concurrent":16,"purpose":"arbitrage_filtering"}
{"level":"warn","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:212","msg":"Concurrent symbol collection failed, falling back to sequential processing","error":"insufficient successful exchanges (0), need at least 2"}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:203","msg":"Starting sequential symbol collection","exchange_count":0}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:203","msg":"Sequential symbol collection completed","successful_exchanges":0,"symbols_on_multiple_exchanges":0,"min_exchanges":2,"total_unique_symbols":0}
{"level":"info","timestamp":"2025-12-24T08:43:25.404+0700","caller":"logging/logger.go:203","msg":"Background initialization complete","workers_started":0}
2025/12/24 08:43:25 WARN Failed to get data statistics before cleanup error="context canceled"
2025/12/24 08:43:25 INFO Using smart cleanup strategy market_data_retention_hours=36 market_data_deletion_hours=12 funding_rates_retention_hours=36 funding_rates_deletion_hours=12
{"level":"warn","timestamp":"2025-12-24T08:43:25.471+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"initial_cleanup","attempt":1,"error":"failed to cleanup market data: context canceled","delay":0.1}
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Stopping market data collector service..."}
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Market data collector service stopped"}
--- PASS: TestCollectorService_Start (0.10s)
=== RUN   TestCollectorService_Stop
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Stopping market data collector service..."}
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Market data collector service stopped"}
--- PASS: TestCollectorService_Stop (0.00s)
=== RUN   TestCollectorService_GetWorkerStatus
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_GetWorkerStatus (0.00s)
=== RUN   TestCollectorService_IsHealthy
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_IsHealthy (0.00s)
=== RUN   TestCollectorService_RestartWorker
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Restarted worker","exchange":"binance"}
--- PASS: TestCollectorService_RestartWorker (0.00s)
=== RUN   TestWorker_Struct
--- PASS: TestWorker_Struct (0.00s)
=== RUN   TestCollectorConfig_Struct
--- PASS: TestCollectorConfig_Struct (0.00s)
=== RUN   TestCollectorService_ValidateMarketData
=== RUN   TestCollectorService_ValidateMarketData/valid_data
=== RUN   TestCollectorService_ValidateMarketData/zero_price
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Worker started","exchange":"binance","symbols":0,"ticker_interval":300,"funding_interval":900}
=== RUN   TestCollectorService_ValidateMarketData/negative_price
=== RUN   TestCollectorService_ValidateMarketData/extremely_high_price
=== RUN   TestCollectorService_ValidateMarketData/negative_volume
=== RUN   TestCollectorService_ValidateMarketData/future_timestamp
=== RUN   TestCollectorService_ValidateMarketData/old_timestamp
--- PASS: TestCollectorService_ValidateMarketData (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/valid_data (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/zero_price (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/negative_price (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/extremely_high_price (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/negative_volume (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/future_timestamp (0.00s)
    --- PASS: TestCollectorService_ValidateMarketData/old_timestamp (0.00s)
=== RUN   TestCollectorService_ParseSymbol
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
=== RUN   TestCollectorService_ParseSymbol/standard_slash_format
=== RUN   TestCollectorService_ParseSymbol/futures_format_with_settlement
=== RUN   TestCollectorService_ParseSymbol/concatenated_format_USDT
=== RUN   TestCollectorService_ParseSymbol/concatenated_format_USD
=== RUN   TestCollectorService_ParseSymbol/invalid_symbol
--- PASS: TestCollectorService_ParseSymbol (0.00s)
    --- PASS: TestCollectorService_ParseSymbol/standard_slash_format (0.00s)
    --- PASS: TestCollectorService_ParseSymbol/futures_format_with_settlement (0.00s)
    --- PASS: TestCollectorService_ParseSymbol/concatenated_format_USDT (0.00s)
    --- PASS: TestCollectorService_ParseSymbol/concatenated_format_USD (0.00s)
    --- PASS: TestCollectorService_ParseSymbol/invalid_symbol (0.00s)
=== RUN   TestCollectorService_IsOptionsContract
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
=== RUN   TestCollectorService_IsOptionsContract/call_option
=== RUN   TestCollectorService_IsOptionsContract/put_option
=== RUN   TestCollectorService_IsOptionsContract/regular_spot_pair
=== RUN   TestCollectorService_IsOptionsContract/futures_pair
--- PASS: TestCollectorService_IsOptionsContract (0.00s)
    --- PASS: TestCollectorService_IsOptionsContract/call_option (0.00s)
    --- PASS: TestCollectorService_IsOptionsContract/put_option (0.00s)
    --- PASS: TestCollectorService_IsOptionsContract/regular_spot_pair (0.00s)
    --- PASS: TestCollectorService_IsOptionsContract/futures_pair (0.00s)
=== RUN   TestCollectorService_IsInvalidSymbolFormat
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
=== RUN   TestCollectorService_IsInvalidSymbolFormat/valid_short_symbol
=== RUN   TestCollectorService_IsInvalidSymbolFormat/too_long_symbol
=== RUN   TestCollectorService_IsInvalidSymbolFormat/multiple_colons
=== RUN   TestCollectorService_IsInvalidSymbolFormat/complex_derivative
--- PASS: TestCollectorService_IsInvalidSymbolFormat (0.00s)
    --- PASS: TestCollectorService_IsInvalidSymbolFormat/valid_short_symbol (0.00s)
    --- PASS: TestCollectorService_IsInvalidSymbolFormat/too_long_symbol (0.00s)
    --- PASS: TestCollectorService_IsInvalidSymbolFormat/multiple_colons (0.00s)
    --- PASS: TestCollectorService_IsInvalidSymbolFormat/complex_derivative (0.00s)
=== RUN   TestCollectorService_CacheBulkTickerData
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.505+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_CacheBulkTickerData (0.00s)
=== RUN   TestCollectorService_CacheBulkTickerData_WithRedis
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.506+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:25.506+0700","caller":"logging/logger.go:203","msg":"Cached tickers in Redis","count":2,"exchange":"binance","ttl":"10s"}
--- PASS: TestCollectorService_CacheBulkTickerData_WithRedis (0.00s)
=== RUN   TestCollectorService_SaveBulkTickerData
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_SaveBulkTickerData (0.00s)
=== RUN   TestCollectorService_SaveBulkTickerData_NilDatabase
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_SaveBulkTickerData_NilDatabase (0.00s)
=== RUN   TestCollectorService_SaveBulkTickerData_InvalidData
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
2025/12/24 08:43:25 Blacklisted symbol binance:BTC/USDT for invalid_price (TTL: 1h0m0s)
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Added symbol to blacklist","symbol":"binance:BTC/USDT","reason":"invalid_price"}
--- PASS: TestCollectorService_SaveBulkTickerData_InvalidData (0.00s)
=== RUN   TestCollectorService_CollectTickerDataDirect
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
2025/12/24 08:43:25 Blacklisted symbol binance:BTC/USDT for invalid_data (TTL: 1h0m0s)
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Skipping blacklisted symbol","reason":"invalid_data","symbol":"binance:BTC/USDT"}
--- PASS: TestCollectorService_CollectTickerDataDirect (0.00s)
=== RUN   TestCollectorService_CollectTickerDataDirect_WithMockCCXT
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.507+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_CollectTickerDataDirect_WithMockCCXT (0.00s)
=== RUN   TestCollectorService_CollectTickerDataDirect_CCXErrorWithBlacklist
2025/12/24 08:43:25 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:25 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:25.508+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"warn","timestamp":"2025-12-24T08:43:25.508+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_single_fetch","attempt":1,"error":"invalid symbol: symbol not found","delay":0.1}
2025/12/24 08:43:25 ERROR Initial cleanup failed error="context canceled"
{"level":"warn","timestamp":"2025-12-24T08:43:25.603+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","delay":0.2,"operation":"ccxt_single_fetch","attempt":2,"error":"invalid symbol: symbol not found"}
{"level":"warn","timestamp":"2025-12-24T08:43:25.755+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_single_fetch","attempt":3,"error":"invalid symbol: symbol not found","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_single_fetch","attempts":4,"duration":0.559984875,"error":"invalid symbol: symbol not found","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectTickerDataDirect.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1597\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectTickerDataDirect\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1596\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectTickerDataDirect_CCXErrorWithBlacklist\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:741\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","failure_count":1,"circuit_breaker":"ccxt","state":"closed","error":"invalid symbol: symbol not found","duration_ms":560}
2025/12/24 08:43:26 Blacklisted symbol binance:INVALID/USDT for symbol_not_found (TTL: 1h0m0s)
{"level":"info","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:203","msg":"Added symbol to blacklist with error","symbol":"binance:INVALID/USDT","reason":"symbol_not_found","error":"invalid symbol: symbol not found"}
--- PASS: TestCollectorService_CollectTickerDataDirect_CCXErrorWithBlacklist (0.56s)
=== RUN   TestCollectorService_CollectFundingRates
2025/12/24 08:43:26 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:26 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"warn","timestamp":"2025-12-24T08:43:26.068+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"funding rates not supported","delay":0.1,"operation":"ccxt_funding_rates","attempt":1}
{"level":"warn","timestamp":"2025-12-24T08:43:26.167+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":2,"error":"funding rates not supported","delay":0.2}
{"level":"warn","timestamp":"2025-12-24T08:43:26.416+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":3,"error":"funding rates not supported","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:26.773+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_funding_rates","attempts":4,"duration":0.705336792,"error":"funding rates not supported","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1699\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1698\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1661\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRates.func1\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:775\ngithub.com/stretchr/testify/assert.didPanic\n\t/Users/irfandi/go/pkg/mod/github.com/stretchr/testify@v1.11.1/assert/assertions.go:1291\ngithub.com/stretchr/testify/assert.NotPanics\n\t/Users/irfandi/go/pkg/mod/github.com/stretchr/testify@v1.11.1/assert/assertions.go:1362\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:774\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:26.773+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","circuit_breaker":"ccxt","state":"closed","error":"funding rates not supported","duration_ms":705,"failure_count":1}
{"level":"info","timestamp":"2025-12-24T08:43:26.773+0700","caller":"logging/logger.go:203","msg":"Exchange does not support funding rates, caching this information","exchange":"binance"}
--- PASS: TestCollectorService_CollectFundingRates (0.71s)
=== RUN   TestCollectorService_CollectFundingRatesBulk
2025/12/24 08:43:26 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:26 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:26.773+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:26.773+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"warn","timestamp":"2025-12-24T08:43:26.774+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"funding rates not supported","delay":0.1,"operation":"ccxt_funding_rates","attempt":1}
{"level":"warn","timestamp":"2025-12-24T08:43:26.889+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":2,"error":"funding rates not supported","delay":0.2}
{"level":"warn","timestamp":"2025-12-24T08:43:27.063+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":3,"error":"funding rates not supported","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_funding_rates","attempts":4,"duration":0.641987542,"error":"funding rates not supported","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1699\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1698\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:801\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","state":"closed","error":"funding rates not supported","duration_ms":642,"failure_count":1,"circuit_breaker":"ccxt"}
{"level":"info","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:203","msg":"Exchange does not support funding rates, caching this information","exchange":"binance"}
{"level":"info","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"info","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:203","msg":"Skipping funding rate collection - exchange does not support funding rates","exchange":"binance"}
--- PASS: TestCollectorService_CollectFundingRatesBulk (0.64s)
=== RUN   TestCollectorService_StoreFundingRate
2025/12/24 08:43:27 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:27 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:27.416+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
--- PASS: TestCollectorService_StoreFundingRate (0.00s)
=== RUN   TestCollectorService_CollectFundingRatesBulk_CapabilityCaching
2025/12/24 08:43:27 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:27 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:27.418+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:27.418+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"warn","timestamp":"2025-12-24T08:43:27.418+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":1,"error":"funding rates not supported","delay":0.1,"operation":"ccxt_funding_rates"}
{"level":"warn","timestamp":"2025-12-24T08:43:27.540+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":2,"error":"funding rates not supported","delay":0.2}
{"level":"warn","timestamp":"2025-12-24T08:43:27.699+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":3,"error":"funding rates not supported","delay":0.4}
{"level":"error","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_funding_rates","attempts":4,"duration":0.688254333,"error":"funding rates not supported","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1699\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1698\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRatesBulk_CapabilityCaching\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:907\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","state":"closed","error":"funding rates not supported","duration_ms":688,"failure_count":1,"circuit_breaker":"ccxt"}
{"level":"info","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:203","msg":"Exchange does not support funding rates, caching this information","exchange":"binance"}
{"level":"info","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"info","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:203","msg":"Skipping funding rate collection - exchange does not support funding rates","exchange":"binance"}
--- PASS: TestCollectorService_CollectFundingRatesBulk_CapabilityCaching (0.69s)
=== RUN   TestCollectorService_CollectFundingRatesBulk_CCXTErrors
2025/12/24 08:43:28 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:28 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"warn","timestamp":"2025-12-24T08:43:28.106+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":1,"error":"exchange API error","delay":0.1,"operation":"ccxt_funding_rates"}
{"level":"warn","timestamp":"2025-12-24T08:43:28.192+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":2,"error":"exchange API error","delay":0.2}
{"level":"warn","timestamp":"2025-12-24T08:43:28.409+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"exchange API error","delay":0.4,"operation":"ccxt_funding_rates","attempt":3}
{"level":"error","timestamp":"2025-12-24T08:43:28.820+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_funding_rates","attempts":4,"duration":0.713719292,"error":"exchange API error","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1699\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1698\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRatesBulk_CCXTErrors\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:938\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:28.820+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","state":"closed","error":"exchange API error","duration_ms":713,"failure_count":1,"circuit_breaker":"ccxt"}
--- PASS: TestCollectorService_CollectFundingRatesBulk_CCXTErrors (0.71s)
=== RUN   TestCollectorService_CollectFundingRatesBulk_Concurrent
2025/12/24 08:43:28 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:28 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
{"level":"info","timestamp":"2025-12-24T08:43:28.820+0700","caller":"logging/logger.go:203","msg":"Redis client not available, using in-memory symbol cache"}
{"level":"info","timestamp":"2025-12-24T08:43:28.820+0700","caller":"logging/logger.go:203","msg":"Starting concurrent funding rate collection","exchange":"binance"}
{"level":"warn","timestamp":"2025-12-24T08:43:28.820+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"ccxt_funding_rates","attempt":1,"error":"funding rates not available","delay":0.1}
{"level":"warn","timestamp":"2025-12-24T08:43:28.910+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":2,"error":"funding rates not available","delay":0.2,"operation":"ccxt_funding_rates"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.101+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","delay":0.4,"operation":"ccxt_funding_rates","attempt":3,"error":"funding rates not available"}
{"level":"error","timestamp":"2025-12-24T08:43:29.424+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"ccxt_funding_rates","attempts":4,"duration":0.60443275,"error":"funding rates not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk.func3\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1699\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CircuitBreaker).Execute\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/circuit_breaker.go:144\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*CollectorService).collectFundingRatesBulk\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector.go:1698\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestCollectorService_CollectFundingRatesBulk_Concurrent\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/collector_test.go:965\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.424+0700","caller":"logging/logger.go:212","msg":"Circuit breaker: failed execution","state":"closed","error":"funding rates not available","duration_ms":604,"failure_count":1,"circuit_breaker":"ccxt"}
--- PASS: TestCollectorService_CollectFundingRatesBulk_Concurrent (0.60s)
=== RUN   TestSymbolCache_Get
--- PASS: TestSymbolCache_Get (0.00s)
=== RUN   TestSymbolCache_Set
--- PASS: TestSymbolCache_Set (0.00s)
=== RUN   TestSymbolCache_GetStats
--- PASS: TestSymbolCache_GetStats (0.00s)
=== RUN   TestSymbolCache_ConcurrentOperations
--- PASS: TestSymbolCache_ConcurrentOperations (0.00s)
=== RUN   TestSymbolCache_EdgeCases
--- PASS: TestSymbolCache_EdgeCases (0.00s)
=== RUN   TestSymbolCache_LogStats
{"level":"info","timestamp":"2025-12-24T08:43:29.425+0700","caller":"logging/logger.go:203","msg":"Symbol Cache Stats","hits":0,"misses":0,"sets":0,"hit_rate_percent":0}
{"level":"info","timestamp":"2025-12-24T08:43:29.425+0700","caller":"logging/logger.go:203","msg":"Symbol Cache Stats","hits":1,"misses":1,"sets":1,"hit_rate_percent":50}
--- PASS: TestSymbolCache_LogStats (0.00s)
=== RUN   TestCollectorService_ConvertMarketPriceInterfacesToModels
--- PASS: TestCollectorService_ConvertMarketPriceInterfacesToModels (0.00s)
=== RUN   TestCollectorService_ConvertMarketPriceInterfaceToModel
--- PASS: TestCollectorService_ConvertMarketPriceInterfaceToModel (0.00s)
=== RUN   TestCollectorService_ConvertMarketPriceInterfaceToModel_FunctionalInterface
--- PASS: TestCollectorService_ConvertMarketPriceInterfaceToModel_FunctionalInterface (0.00s)
=== RUN   TestEnhancedArbitrageSignalFormatting

=== Enhanced Arbitrage Signal Format ===
 *ARBITRAGE ALERT: BTC/USDT*

 Profit: *0.80% - 1.40%* ($160 - $280 on $20000)
 BUY: $41750.5000 - $41850.7500 (Binance, Kraken, OKX, Bybit, KuCoin)
 SELL: $42250.8000 - $42350.9000 (Coinbase, Gate.io, MEXC)
 Valid for: *5 minutes*
 Min Volume: *$10000*
 Opportunities: *8*
 Confidence: *85.0%*

 *Act fast!* Arbitrage opportunities disappear quickly.
 *Min Volume* helps filter out low-liquidity fake signals.
==========================================
=== Signal Metadata JSON ===
{
  "buy_exchanges": [
    "Binance",
    "Kraken",
    "OKX",
    "Bybit",
    "KuCoin"
  ],
  "buy_price_range": {
    "avg": "41800.25",
    "max": "41850.75",
    "min": "41750.5"
  },
  "min_volume": "10000",
  "opportunity_count": 8,
  "profit_range": {
    "avg_dollar": "240",
    "avg_percent": "1.2",
    "base_amount": "20000",
    "max_dollar": "280",
    "max_percent": "1.4",
    "min_dollar": "160",
    "min_percent": "0.8"
  },
  "sell_exchanges": [
    "Coinbase",
    "Gate.io",
    "MEXC"
  ],
  "sell_price_range": {
    "avg": "42300.85",
    "max": "42350.9",
    "min": "42250.8"
  },
  "validity_minutes": 5
}
============================
--- PASS: TestEnhancedArbitrageSignalFormatting (0.00s)
=== RUN   TestArbitragePriceRangeCalculation

=== Price Range Calculations ===
Buy Range: $41750.5 - $41850.75 (avg: $41799.51)
Sell Range: $42250.8 - $42350.9 (avg: $42294.05)
Profit Range: 1.0% - 1.4% (avg: 1.2%)
Dollar Range: $191 - $288 (avg: $237 on $20000)
=================================
--- PASS: TestArbitragePriceRangeCalculation (0.00s)
=== RUN   TestErrorRecoveryManager_NewErrorRecoveryManager
--- PASS: TestErrorRecoveryManager_NewErrorRecoveryManager (0.00s)
=== RUN   TestErrorRecoveryManager_RegisterCircuitBreaker
--- PASS: TestErrorRecoveryManager_RegisterCircuitBreaker (0.00s)
=== RUN   TestErrorRecoveryManager_RegisterRetryPolicy
--- PASS: TestErrorRecoveryManager_RegisterRetryPolicy (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRecovery_Success
--- PASS: TestErrorRecoveryManager_ExecuteWithRecovery_Success (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRecovery_Failure
--- PASS: TestErrorRecoveryManager_ExecuteWithRecovery_Failure (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRecovery_Fallback
--- PASS: TestErrorRecoveryManager_ExecuteWithRecovery_Fallback (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRetry
--- PASS: TestErrorRecoveryManager_ExecuteWithRetry (0.03s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRetry_ContextCancellation
--- PASS: TestErrorRecoveryManager_ExecuteWithRetry_ContextCancellation (0.10s)
=== RUN   TestErrorRecoveryManager_CalculateDelay
--- PASS: TestErrorRecoveryManager_CalculateDelay (0.00s)
=== RUN   TestErrorRecoveryManager_DegradationMode
{"level":"warn","timestamp":"2025-12-24T08:43:29.558+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.558+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
--- PASS: TestErrorRecoveryManager_DegradationMode (0.00s)
=== RUN   TestErrorRecoveryManager_GetCircuitBreakerStatus
--- PASS: TestErrorRecoveryManager_GetCircuitBreakerStatus (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRetry_ErrorOnly
--- PASS: TestErrorRecoveryManager_ExecuteWithRetry_ErrorOnly (0.00s)
=== RUN   TestErrorRecoveryManager_ExecuteWithRetry_ErrorOnly_WithRetries
{"level":"warn","timestamp":"2025-12-24T08:43:29.559+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"test_operation","attempt":1,"error":"temporary failure","delay":0.01}
{"level":"warn","timestamp":"2025-12-24T08:43:29.570+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"temporary failure","delay":0.02,"operation":"test_operation","attempt":2}
{"level":"info","timestamp":"2025-12-24T08:43:29.590+0700","caller":"logging/logger.go:203","msg":"Operation recovered after retry","operation":"test_operation","attempts":3,"duration":0.03140125}
--- PASS: TestErrorRecoveryManager_ExecuteWithRetry_ErrorOnly_WithRetries (0.03s)
=== RUN   TestErrorRecoveryManager_DefaultRetryPolicies
--- PASS: TestErrorRecoveryManager_DefaultRetryPolicies (0.00s)
=== RUN   TestErrorRecoveryManager_ConcurrentOperations
--- PASS: TestErrorRecoveryManager_ConcurrentOperations (0.03s)
=== RUN   TestErrorRecoveryManager_TimeHandling
--- PASS: TestErrorRecoveryManager_TimeHandling (0.05s)
=== RUN   TestErrorRecoveryManager_StateManagement
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:212","msg":"Error recovery manager entered degradation mode"}
{"level":"info","timestamp":"2025-12-24T08:43:29.673+0700","caller":"logging/logger.go:203","msg":"Error recovery manager exited degradation mode"}
--- PASS: TestErrorRecoveryManager_StateManagement (0.00s)
=== RUN   TestNewExchangeReliabilityTracker
--- PASS: TestNewExchangeReliabilityTracker (0.00s)
=== RUN   TestRecordAPICall
=== RUN   TestRecordAPICall/successful_call_to_binance
=== RUN   TestRecordAPICall/failed_call_to_binance
=== RUN   TestRecordAPICall/call_to_new_exchange
--- PASS: TestRecordAPICall (0.00s)
    --- PASS: TestRecordAPICall/successful_call_to_binance (0.00s)
    --- PASS: TestRecordAPICall/failed_call_to_binance (0.00s)
    --- PASS: TestRecordAPICall/call_to_new_exchange (0.00s)
=== RUN   TestRecordSuccessAndFailure
    exchange_reliability_test.go:136: Uptime after failures: 83.33333333333334% (expected ~83.33%)
--- PASS: TestRecordSuccessAndFailure (0.00s)
=== RUN   TestGetReliabilityScore
--- PASS: TestGetReliabilityScore (0.00s)
=== RUN   TestExchangeReliabilityRiskScoreCalculation
=== RUN   TestExchangeReliabilityRiskScoreCalculation/perfect_reliability
    exchange_reliability_test.go:242: Test: perfect reliability, Risk Score: 9 (expected: 0-6)
=== RUN   TestExchangeReliabilityRiskScoreCalculation/good_reliability
    exchange_reliability_test.go:242: Test: good reliability, Risk Score: 10.72 (expected: 5-10)
=== RUN   TestExchangeReliabilityRiskScoreCalculation/poor_reliability_with_failures
    exchange_reliability_test.go:242: Test: poor reliability with failures, Risk Score: 20 (expected: 15-20)
--- PASS: TestExchangeReliabilityRiskScoreCalculation (0.00s)
    --- PASS: TestExchangeReliabilityRiskScoreCalculation/perfect_reliability (0.00s)
    --- PASS: TestExchangeReliabilityRiskScoreCalculation/good_reliability (0.00s)
    --- PASS: TestExchangeReliabilityRiskScoreCalculation/poor_reliability_with_failures (0.00s)
=== RUN   TestGetExchangeRiskForArbitrage
    exchange_reliability_test.go:270: Binance risk: 5, OKX risk: 16.5, Combined: 16.5
--- PASS: TestGetExchangeRiskForArbitrage (0.00s)
=== RUN   TestResetCounters
--- PASS: TestResetCounters (0.00s)
=== RUN   TestResetAllCounters
--- PASS: TestResetAllCounters (0.00s)
=== RUN   TestGetAllReliabilityMetrics
--- PASS: TestGetAllReliabilityMetrics (0.00s)
=== RUN   TestConcurrentAccess
--- PASS: TestConcurrentAccess (0.00s)
=== RUN   TestConsecutiveFailuresTracking
--- PASS: TestConsecutiveFailuresTracking (0.00s)
=== RUN   TestDBFeeProvider_GetTakerFee_UsesDatabase
--- PASS: TestDBFeeProvider_GetTakerFee_UsesDatabase (0.00s)
=== RUN   TestDBFeeProvider_GetMakerFee_DefaultOnError
--- PASS: TestDBFeeProvider_GetMakerFee_DefaultOnError (0.00s)
=== RUN   TestDBFeeProvider_GetTakerFee_FallbackToExchange
--- PASS: TestDBFeeProvider_GetTakerFee_FallbackToExchange (0.00s)
=== RUN   TestFuturesArbitrageCalculator_calculateLiquidityScore
    futures_arbitrage_calculator_comprehensive_test.go:28: Actual score: 99.999
    futures_arbitrage_calculator_comprehensive_test.go:41: Wide spread score: 97
    futures_arbitrage_calculator_comprehensive_test.go:56: Large amount score: 93.999
    futures_arbitrage_calculator_comprehensive_test.go:71: Small amount score: 99.999
--- PASS: TestFuturesArbitrageCalculator_calculateLiquidityScore (0.00s)
=== RUN   TestFuturesArbitrageCalculator_calculateNextFundingTime
--- PASS: TestFuturesArbitrageCalculator_calculateNextFundingTime (0.00s)
=== RUN   TestFuturesArbitrageCalculator_calculatePriceCorrelation
--- PASS: TestFuturesArbitrageCalculator_calculatePriceCorrelation (0.00s)
=== RUN   TestFuturesArbitrageCalculator_calculatePearsonCorrelation
--- PASS: TestFuturesArbitrageCalculator_calculatePearsonCorrelation (0.00s)
=== RUN   TestFuturesArbitrageCalculator_CalculateFuturesArbitrage
--- PASS: TestFuturesArbitrageCalculator_CalculateFuturesArbitrage (0.00s)
=== RUN   TestFuturesArbitrageCalculator_CalculatePositionSizing
--- PASS: TestFuturesArbitrageCalculator_CalculatePositionSizing (0.00s)
=== RUN   TestFuturesArbitrageCalculator_CalculateRiskScore
--- PASS: TestFuturesArbitrageCalculator_CalculateRiskScore (0.00s)
=== RUN   TestFuturesArbitrageCalculator_CalculateRiskMetrics
--- PASS: TestFuturesArbitrageCalculator_CalculateRiskMetrics (0.00s)
=== RUN   TestFuturesArbitrageCalculator_CalculateAPY
    futures_arbitrage_calculator_comprehensive_test.go:397: Hourly rate: 0.001, APY: 1000
--- PASS: TestFuturesArbitrageCalculator_CalculateAPY (0.00s)
=== RUN   TestFuturesArbitrageCalculator_calculatePeriodProfit
--- PASS: TestFuturesArbitrageCalculator_calculatePeriodProfit (0.00s)
=== RUN   TestNewFuturesArbitrageCalculator
--- PASS: TestNewFuturesArbitrageCalculator (0.00s)
=== RUN   TestCalculateFuturesArbitrage
=== RUN   TestCalculateFuturesArbitrage/valid_arbitrage_opportunity
=== RUN   TestCalculateFuturesArbitrage/profitable_arbitrage
=== RUN   TestCalculateFuturesArbitrage/high_funding_rate_difference
=== RUN   TestCalculateFuturesArbitrage/zero_funding_rates
--- PASS: TestCalculateFuturesArbitrage (0.00s)
    --- PASS: TestCalculateFuturesArbitrage/valid_arbitrage_opportunity (0.00s)
    --- PASS: TestCalculateFuturesArbitrage/profitable_arbitrage (0.00s)
    --- PASS: TestCalculateFuturesArbitrage/high_funding_rate_difference (0.00s)
    --- PASS: TestCalculateFuturesArbitrage/zero_funding_rates (0.00s)
=== RUN   TestCalculateRiskScore
=== RUN   TestCalculateRiskScore/low_risk_scenario
=== RUN   TestCalculateRiskScore/high_risk_scenario
--- PASS: TestCalculateRiskScore (0.00s)
    --- PASS: TestCalculateRiskScore/low_risk_scenario (0.00s)
    --- PASS: TestCalculateRiskScore/high_risk_scenario (0.00s)
=== RUN   TestCalculatePositionSizing
--- PASS: TestCalculatePositionSizing (0.00s)
=== RUN   TestCalculateRiskMetrics
--- PASS: TestCalculateRiskMetrics (0.00s)
=== RUN   TestCalculateAPY
    futures_arbitrage_calculator_test.go:289: Hourly rate: 0.001, APY: 1000
--- PASS: TestCalculateAPY (0.00s)
=== RUN   TestCalculateEstimatedProfits
--- PASS: TestCalculateEstimatedProfits (0.00s)
=== RUN   TestAPYOverflowProtection
=== RUN   TestAPYOverflowProtection/normal_positive_rate
    futures_arbitrage_enhanced_test.go:79: Normal rates should calculate without capping: hourly rate=0.0001, APY=140.11702025509942%
=== RUN   TestAPYOverflowProtection/high_positive_rate
    futures_arbitrage_enhanced_test.go:79: High but reasonable rates: hourly rate=0.001, APY=1000%
=== RUN   TestAPYOverflowProtection/extreme_positive_rate_-_should_be_capped
    futures_arbitrage_enhanced_test.go:79: Extreme rates should be capped at 1000%: hourly rate=0.05, APY=1000%
=== RUN   TestAPYOverflowProtection/overflow-causing_rate_-_should_be_capped
    futures_arbitrage_enhanced_test.go:79: Overflow-causing rates should be safely capped: hourly rate=0.5, APY=1000%
=== RUN   TestAPYOverflowProtection/negative_rate
    futures_arbitrage_enhanced_test.go:79: Negative rates should return negative APY: hourly rate=-0.001, APY=-99.98438014997679%
=== RUN   TestAPYOverflowProtection/extreme_negative_rate_-_should_be_capped
    futures_arbitrage_enhanced_test.go:79: Extreme negative rates should be capped at -100%: hourly rate=-0.5, APY=-100%
=== RUN   TestAPYOverflowProtection/zero_rate
    futures_arbitrage_enhanced_test.go:79: Zero rate should return ~0%: hourly rate=0, APY=0%
--- PASS: TestAPYOverflowProtection (0.00s)
    --- PASS: TestAPYOverflowProtection/normal_positive_rate (0.00s)
    --- PASS: TestAPYOverflowProtection/high_positive_rate (0.00s)
    --- PASS: TestAPYOverflowProtection/extreme_positive_rate_-_should_be_capped (0.00s)
    --- PASS: TestAPYOverflowProtection/overflow-causing_rate_-_should_be_capped (0.00s)
    --- PASS: TestAPYOverflowProtection/negative_rate (0.00s)
    --- PASS: TestAPYOverflowProtection/extreme_negative_rate_-_should_be_capped (0.00s)
    --- PASS: TestAPYOverflowProtection/zero_rate (0.00s)
=== RUN   TestNextFundingTimeCalculation
    futures_arbitrage_enhanced_test.go:129: Next funding: 2025-12-24 08:00:00, Time to next: 376 min
--- PASS: TestNextFundingTimeCalculation (0.00s)
=== RUN   TestSlippageEstimation
=== RUN   TestSlippageEstimation/small_position_-_no_order_book_data
    futures_arbitrage_enhanced_test.go:200: Position: $10000, Slippage: 0.05%
=== RUN   TestSlippageEstimation/medium_position_-_no_order_book_data
    futures_arbitrage_enhanced_test.go:200: Position: $75000, Slippage: 0.1%
=== RUN   TestSlippageEstimation/large_position_-_no_order_book_data
    futures_arbitrage_enhanced_test.go:200: Position: $150000, Slippage: 0.2%
=== RUN   TestSlippageEstimation/with_order_book_data
    futures_arbitrage_enhanced_test.go:200: Position: $10000, Slippage: 0.05%
--- PASS: TestSlippageEstimation (0.00s)
    --- PASS: TestSlippageEstimation/small_position_-_no_order_book_data (0.00s)
    --- PASS: TestSlippageEstimation/medium_position_-_no_order_book_data (0.00s)
    --- PASS: TestSlippageEstimation/large_position_-_no_order_book_data (0.00s)
    --- PASS: TestSlippageEstimation/with_order_book_data (0.00s)
=== RUN   TestLiquidityScoreWithOrderBook
=== RUN   TestLiquidityScoreWithOrderBook/excellent_liquidity_on_both_exchanges
    futures_arbitrage_enhanced_test.go:288: Liquidity score: 99.2 (expected: 85-100)
=== RUN   TestLiquidityScoreWithOrderBook/asymmetric_liquidity_-_wide_spread_on_one_side
    futures_arbitrage_enhanced_test.go:288: Liquidity score: 95.6 (expected: 90-100)
=== RUN   TestLiquidityScoreWithOrderBook/nil_order_book_-_uses_fallback
    futures_arbitrage_enhanced_test.go:288: Liquidity score: 98 (expected: 0-100)
--- PASS: TestLiquidityScoreWithOrderBook (0.00s)
    --- PASS: TestLiquidityScoreWithOrderBook/excellent_liquidity_on_both_exchanges (0.00s)
    --- PASS: TestLiquidityScoreWithOrderBook/asymmetric_liquidity_-_wide_spread_on_one_side (0.00s)
    --- PASS: TestLiquidityScoreWithOrderBook/nil_order_book_-_uses_fallback (0.00s)
=== RUN   TestCalculateFuturesArbitrageWithOrderBook
    futures_arbitrage_enhanced_test.go:360: Opportunity: APY=1000%, RiskScore=63, LiquidityScore=98
--- PASS: TestCalculateFuturesArbitrageWithOrderBook (0.00s)
=== RUN   TestFundingRateStats
--- PASS: TestFundingRateStats (0.00s)
=== RUN   TestOrderBookMetricsMethods
    futures_arbitrage_enhanced_test.go:418: Calculated spread: 0.04%
    futures_arbitrage_enhanced_test.go:430: Imbalance signal: neutral (imbalance: 0.111)
--- PASS: TestOrderBookMetricsMethods (0.00s)
=== RUN   TestExchangeReliabilityMetrics
--- PASS: TestExchangeReliabilityMetrics (0.00s)
=== RUN   TestFuturesArbitrageService_New
--- PASS: TestFuturesArbitrageService_New (0.00s)
=== RUN   TestFuturesArbitrageService_StartStop
--- PASS: TestFuturesArbitrageService_StartStop (0.00s)
=== RUN   TestFuturesArbitrageService_IsRunning
--- PASS: TestFuturesArbitrageService_IsRunning (0.00s)
=== RUN   TestFundingRateData_Struct
--- PASS: TestFundingRateData_Struct (0.00s)
=== RUN   TestFuturesArbitrageService_getLatestFundingRates_CacheHit
{"level":"info","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
--- PASS: TestFuturesArbitrageService_getLatestFundingRates_CacheHit (0.00s)
=== RUN   TestFuturesArbitrageService_getLatestFundingRates_CacheMiss
{"level":"info","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
--- PASS: TestFuturesArbitrageService_getLatestFundingRates_CacheMiss (0.00s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_NoFundingRates
{"level":"info","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","operation":"arbitrage_detection","service":"futures_arbitrage"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_NoFundingRates (0.00s)
=== RUN   TestFuturesArbitrageService_storeOpportunity
--- PASS: TestFuturesArbitrageService_storeOpportunity (0.00s)
=== RUN   TestFuturesArbitrageService_cleanupExpiredOpportunities
--- PASS: TestFuturesArbitrageService_cleanupExpiredOpportunities (0.00s)
=== RUN   TestFuturesArbitrageService_Start
--- PASS: TestFuturesArbitrageService_Start (0.00s)
=== RUN   TestFuturesArbitrageService_Stop
--- PASS: TestFuturesArbitrageService_Stop (0.00s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_Success
{"level":"info","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","operation":"arbitrage_detection","service":"futures_arbitrage"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_Success (0.00s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_NoRates
{"level":"info","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","operation":"arbitrage_detection","service":"futures_arbitrage"}
{"level":"warn","timestamp":"2025-12-24T08:43:29.679+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"cleanup_opportunities","attempt":1,"error":"database pool is not available","delay":0.1}
{"level":"warn","timestamp":"2025-12-24T08:43:29.794+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"cleanup_opportunities","attempt":2,"error":"database pool is not available","delay":0.2}
{"level":"warn","timestamp":"2025-12-24T08:43:29.945+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"database pool is not available","delay":0.4,"operation":"cleanup_opportunities","attempt":3}
{"level":"error","timestamp":"2025-12-24T08:43:30.321+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","attempts":4,"duration":0.641587042,"error":"database pool is not available","operation":"cleanup_opportunities","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:184\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_NoRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:427\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:30.321+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup expired opportunities","error":"database pool is not available"}
{"level":"info","timestamp":"2025-12-24T08:43:30.321+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:30.321+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":1,"error":"database pool is not available","delay":0.1}
{"level":"info","timestamp":"2025-12-24T08:43:30.435+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:30.435+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":2,"error":"database pool is not available","delay":0.2}
{"level":"info","timestamp":"2025-12-24T08:43:30.619+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:30.619+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","delay":0.4,"operation":"get_funding_rates","attempt":3,"error":"database pool is not available"}
{"level":"info","timestamp":"2025-12-24T08:43:31.042+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"error","timestamp":"2025-12-24T08:43:31.042+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","attempts":4,"duration":0.720692958,"error":"database pool is not available","operation":"get_funding_rates","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:193\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_NoRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:427\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"error","timestamp":"2025-12-24T08:43:31.042+0700","caller":"logging/logger.go:221","msg":"Error getting funding rates","error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:199\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_NoRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:427\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_NoRates (1.36s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_EmptyRates
{"level":"info","timestamp":"2025-12-24T08:43:31.042+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","operation":"arbitrage_detection","service":"futures_arbitrage"}
{"level":"warn","timestamp":"2025-12-24T08:43:31.042+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"cleanup_opportunities","attempt":1,"error":"database pool is not available","delay":0.1}
{"level":"warn","timestamp":"2025-12-24T08:43:31.138+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":2,"error":"database pool is not available","delay":0.2,"operation":"cleanup_opportunities"}
{"level":"warn","timestamp":"2025-12-24T08:43:31.385+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","delay":0.4,"operation":"cleanup_opportunities","attempt":3,"error":"database pool is not available"}
{"level":"error","timestamp":"2025-12-24T08:43:31.796+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"cleanup_opportunities","attempts":4,"duration":0.754156209,"error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:184\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_EmptyRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:454\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:31.796+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup expired opportunities","error":"database pool is not available"}
{"level":"info","timestamp":"2025-12-24T08:43:31.796+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:31.796+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":1,"error":"database pool is not available","delay":0.1}
{"level":"info","timestamp":"2025-12-24T08:43:31.916+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:31.916+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":2,"error":"database pool is not available","delay":0.2}
{"level":"info","timestamp":"2025-12-24T08:43:32.084+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:32.084+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":3,"error":"database pool is not available","delay":0.4}
{"level":"info","timestamp":"2025-12-24T08:43:32.450+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"error","timestamp":"2025-12-24T08:43:32.450+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"get_funding_rates","attempts":4,"duration":0.653813709,"error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:193\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_EmptyRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:454\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"error","timestamp":"2025-12-24T08:43:32.450+0700","caller":"logging/logger.go:221","msg":"Error getting funding rates","error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:199\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_EmptyRates\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:454\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_EmptyRates (1.41s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_CleanupError
{"level":"info","timestamp":"2025-12-24T08:43:32.450+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","service":"futures_arbitrage","operation":"arbitrage_detection"}
{"level":"warn","timestamp":"2025-12-24T08:43:32.450+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":1,"error":"database pool is not available","delay":0.1,"operation":"cleanup_opportunities"}
{"level":"warn","timestamp":"2025-12-24T08:43:32.563+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","attempt":2,"error":"database pool is not available","delay":0.2,"operation":"cleanup_opportunities"}
{"level":"warn","timestamp":"2025-12-24T08:43:32.775+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"database pool is not available","delay":0.4,"operation":"cleanup_opportunities","attempt":3}
{"level":"error","timestamp":"2025-12-24T08:43:33.146+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","error":"database pool is not available","operation":"cleanup_opportunities","attempts":4,"duration":0.69579125,"stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:184\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_CleanupError\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:482\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"warn","timestamp":"2025-12-24T08:43:33.146+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup expired opportunities","error":"database pool is not available"}
{"level":"info","timestamp":"2025-12-24T08:43:33.146+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:33.146+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","error":"database pool is not available","delay":0.1,"operation":"get_funding_rates","attempt":1}
{"level":"info","timestamp":"2025-12-24T08:43:33.253+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:33.253+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":2,"error":"database pool is not available","delay":0.2}
{"level":"info","timestamp":"2025-12-24T08:43:33.417+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"warn","timestamp":"2025-12-24T08:43:33.418+0700","caller":"logging/logger.go:212","msg":"Operation failed, retrying","operation":"get_funding_rates","attempt":3,"error":"database pool is not available","delay":0.4}
{"level":"info","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:203","msg":"Getting latest funding rates","operation":"data_retrieval"}
{"level":"error","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:221","msg":"Operation failed after all retries","operation":"get_funding_rates","attempts":4,"duration":0.733747083,"error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ErrorRecoveryManager).ExecuteWithRetry\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/error_recovery.go:431\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:193\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_CleanupError\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:482\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
{"level":"error","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:221","msg":"Error getting funding rates","error":"database pool is not available","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:199\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_CleanupError\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:482\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_CleanupError (1.43s)
=== RUN   TestFuturesArbitrageService_calculateAndStoreOpportunities_ContextCancellation
{"level":"info","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:203","msg":"Starting futures arbitrage opportunity calculation","operation":"arbitrage_detection","service":"futures_arbitrage"}
{"level":"warn","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:212","msg":"Failed to cleanup expired opportunities","error":"context canceled"}
{"level":"error","timestamp":"2025-12-24T08:43:33.880+0700","caller":"logging/logger.go:221","msg":"Error getting funding rates","error":"context canceled","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*FuturesArbitrageService).calculateAndStoreOpportunities\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service.go:199\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestFuturesArbitrageService_calculateAndStoreOpportunities_ContextCancellation\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/futures_arbitrage_service_test.go:512\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestFuturesArbitrageService_calculateAndStoreOpportunities_ContextCancellation (0.00s)
=== RUN   TestFuturesArbitrageService_Start_Success
--- PASS: TestFuturesArbitrageService_Start_Success (0.00s)
=== RUN   TestFuturesArbitrageService_Start_AlreadyRunning
--- PASS: TestFuturesArbitrageService_Start_AlreadyRunning (0.00s)
=== RUN   TestFuturesArbitrageService_Start_ContextManagement
--- PASS: TestFuturesArbitrageService_Start_ContextManagement (0.00s)
=== RUN   TestFuturesArbitrageService_Start_MultipleCycles
--- PASS: TestFuturesArbitrageService_Start_MultipleCycles (0.00s)
=== RUN   TestFuturesArbitrageService_runOpportunityCalculator_ContextCancellation
--- PASS: TestFuturesArbitrageService_runOpportunityCalculator_ContextCancellation (0.06s)
=== RUN   TestFuturesArbitrageService_runOpportunityCalculator_ResourceManagement
--- PASS: TestFuturesArbitrageService_runOpportunityCalculator_ResourceManagement (0.06s)
=== RUN   TestMultiLegArbitrageCalculator_FindTriangularOpportunities
--- PASS: TestMultiLegArbitrageCalculator_FindTriangularOpportunities (0.00s)
=== RUN   TestMultiLegArbitrageCalculator_CalculateTriangularOpp_Negative
--- PASS: TestMultiLegArbitrageCalculator_CalculateTriangularOpp_Negative (0.00s)
=== RUN   TestNewNotificationService
2025/12/24 08:43:34 INFO Connected to Telegram gRPC service address=localhost:50052
--- PASS: TestNewNotificationService (0.00s)
=== RUN   TestArbitrageOpportunity_Struct
--- PASS: TestArbitrageOpportunity_Struct (0.00s)
=== RUN   TestNotificationService_formatArbitrageMessage
--- PASS: TestNotificationService_formatArbitrageMessage (0.00s)
=== RUN   TestNotificationService_OpportunityCategorization
--- PASS: TestNotificationService_OpportunityCategorization (0.00s)
=== RUN   TestArbitrageOpportunity_EdgeCases
--- PASS: TestArbitrageOpportunity_EdgeCases (0.00s)
=== RUN   TestNotificationService_formatArbitrageMessage_EdgeCases
--- PASS: TestNotificationService_formatArbitrageMessage_EdgeCases (0.00s)
=== RUN   TestNotificationService_StructFields
--- PASS: TestNotificationService_StructFields (0.00s)
=== RUN   TestArbitrageOpportunity_JSONStructure
--- PASS: TestArbitrageOpportunity_JSONStructure (0.00s)
=== RUN   TestNotificationService_formatArbitrageMessage_ExactlyThree
--- PASS: TestNotificationService_formatArbitrageMessage_ExactlyThree (0.00s)
=== RUN   TestNotificationService_formatArbitrageMessage_MoreThanThree
--- PASS: TestNotificationService_formatArbitrageMessage_MoreThanThree (0.00s)
=== RUN   TestNotificationService_PublishOpportunityUpdate
--- PASS: TestNotificationService_PublishOpportunityUpdate (0.00s)
=== RUN   TestNotificationService_GetCacheStats
--- PASS: TestNotificationService_GetCacheStats (0.00s)
=== RUN   TestNotificationService_cacheArbitrageOpportunities
--- PASS: TestNotificationService_cacheArbitrageOpportunities (0.00s)
=== RUN   TestNotificationService_CacheMarketData
--- PASS: TestNotificationService_CacheMarketData (0.00s)
=== RUN   TestNotificationService_GetCachedMarketData
--- PASS: TestNotificationService_GetCachedMarketData (0.00s)
=== RUN   TestNotificationService_InvalidateUserCache
--- PASS: TestNotificationService_InvalidateUserCache (0.00s)
=== RUN   TestNotificationService_InvalidateOpportunityCache
--- PASS: TestNotificationService_InvalidateOpportunityCache (0.00s)
=== RUN   TestNotificationService_formatTechnicalSignalMessage
--- PASS: TestNotificationService_formatTechnicalSignalMessage (0.00s)
=== RUN   TestNotificationService_ConvertAggregatedSignalToNotification
--- PASS: TestNotificationService_ConvertAggregatedSignalToNotification (0.00s)
=== RUN   TestNotificationService_generateOpportunityHash
--- PASS: TestNotificationService_generateOpportunityHash (0.00s)
=== RUN   TestNotificationService_generateTechnicalSignalsHash
--- PASS: TestNotificationService_generateTechnicalSignalsHash (0.00s)
=== RUN   TestNotificationService_getCachedMessage
--- PASS: TestNotificationService_getCachedMessage (0.00s)
=== RUN   TestNotificationService_setCachedMessage
--- PASS: TestNotificationService_setCachedMessage (0.00s)
=== RUN   TestNotificationService_checkRateLimit
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
--- PASS: TestNotificationService_checkRateLimit (0.00s)
=== RUN   TestNotificationService_checkRateLimit_Comprehensive
=== RUN   TestNotificationService_checkRateLimit_Comprehensive/NilRedis
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
=== RUN   TestNotificationService_checkRateLimit_Comprehensive/DifferentUserIDs
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=user1
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=user2
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=user3
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=user-with-dashes
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=user_123
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=""
=== RUN   TestNotificationService_checkRateLimit_Comprehensive/DifferentContexts
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
=== RUN   TestNotificationService_checkRateLimit_Comprehensive/TimeoutContext
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
=== RUN   TestNotificationService_checkRateLimit_Comprehensive/ConcurrentCalls
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
2025/12/24 08:43:34 WARN Rate limit check denied: Redis not available user_id=testuser
--- PASS: TestNotificationService_checkRateLimit_Comprehensive (0.00s)
    --- PASS: TestNotificationService_checkRateLimit_Comprehensive/NilRedis (0.00s)
    --- PASS: TestNotificationService_checkRateLimit_Comprehensive/DifferentUserIDs (0.00s)
    --- PASS: TestNotificationService_checkRateLimit_Comprehensive/DifferentContexts (0.00s)
    --- PASS: TestNotificationService_checkRateLimit_Comprehensive/TimeoutContext (0.00s)
    --- PASS: TestNotificationService_checkRateLimit_Comprehensive/ConcurrentCalls (0.00s)
=== RUN   TestNotificationService_logNotification
--- PASS: TestNotificationService_logNotification (0.00s)
=== RUN   TestNotificationService_CheckUserNotificationPreferences
--- PASS: TestNotificationService_CheckUserNotificationPreferences (0.00s)
=== RUN   TestNotificationService_generateAggregatedSignalsHash
--- PASS: TestNotificationService_generateAggregatedSignalsHash (0.00s)
=== RUN   TestNotificationService_formatEnhancedArbitrageMessage
--- PASS: TestNotificationService_formatEnhancedArbitrageMessage (0.00s)
=== RUN   TestNotificationService_formatAggregatedArbitrageMessage
--- PASS: TestNotificationService_formatAggregatedArbitrageMessage (0.00s)
=== RUN   TestNotificationService_formatAggregatedTechnicalMessage
--- PASS: TestNotificationService_formatAggregatedTechnicalMessage (0.00s)
=== RUN   TestNotificationService_NotifyArbitrageOpportunities_EmptyOpportunities
--- PASS: TestNotificationService_NotifyArbitrageOpportunities_EmptyOpportunities (0.00s)
=== RUN   TestNotificationService_NotifyArbitrageOpportunities_CategorizationLogic
--- PASS: TestNotificationService_NotifyArbitrageOpportunities_CategorizationLogic (0.00s)
=== RUN   TestNotificationService_NotifyArbitrageOpportunities_MixedTypes
--- PASS: TestNotificationService_NotifyArbitrageOpportunities_MixedTypes (0.00s)
=== RUN   TestNotificationService_NotifyArbitrageOpportunities_WithDatabase
--- PASS: TestNotificationService_NotifyArbitrageOpportunities_WithDatabase (0.00s)
=== RUN   TestNotificationService_getEligibleUsers_NilDependencies
--- PASS: TestNotificationService_getEligibleUsers_NilDependencies (0.00s)
=== RUN   TestNotificationService_getEligibleUsers_CacheKey
--- PASS: TestNotificationService_getEligibleUsers_CacheKey (0.00s)
=== RUN   TestNotificationService_getEligibleUsers_QueryLogic
--- PASS: TestNotificationService_getEligibleUsers_QueryLogic (0.00s)
=== RUN   TestNotificationService_getEligibleUsers_ContextCancellation
--- PASS: TestNotificationService_getEligibleUsers_ContextCancellation (0.00s)
=== RUN   TestNewPerformanceMonitor
--- PASS: TestNewPerformanceMonitor (0.00s)
=== RUN   TestPerformanceMonitor_Start
{"level":"info","timestamp":"2025-12-24T08:43:34.008+0700","caller":"logging/logger.go:203","msg":"Starting performance monitor"}
{"level":"info","timestamp":"2025-12-24T08:43:34.109+0700","caller":"logging/logger.go:203","msg":"Performance monitor context cancelled"}
--- PASS: TestPerformanceMonitor_Start (0.15s)
=== RUN   TestPerformanceMonitor_Stop
{"level":"info","timestamp":"2025-12-24T08:43:34.160+0700","caller":"logging/logger.go:203","msg":"Starting performance monitor"}
{"level":"info","timestamp":"2025-12-24T08:43:34.210+0700","caller":"logging/logger.go:203","msg":"Performance monitor stopped"}
--- PASS: TestPerformanceMonitor_Stop (0.10s)
=== RUN   TestPerformanceMonitor_GetSystemMetrics
--- PASS: TestPerformanceMonitor_GetSystemMetrics (0.00s)
=== RUN   TestPerformanceMonitor_GetApplicationMetrics
{"level":"warn","timestamp":"2025-12-24T08:43:34.263+0700","caller":"logging/logger.go:212","msg":"Failed to get Redis info","error":"ERR wrong number of arguments for 'info' command"}
--- PASS: TestPerformanceMonitor_GetApplicationMetrics (0.00s)
=== RUN   TestPerformanceMonitor_UpdateCollectorMetrics
--- PASS: TestPerformanceMonitor_UpdateCollectorMetrics (0.00s)
=== RUN   TestPerformanceMonitor_UpdateAPIMetrics
--- PASS: TestPerformanceMonitor_UpdateAPIMetrics (0.00s)
=== RUN   TestPerformanceMonitor_UpdateTelegramMetrics
--- PASS: TestPerformanceMonitor_UpdateTelegramMetrics (0.00s)
=== RUN   TestPerformanceMonitor_RecordWorkerHealth
--- PASS: TestPerformanceMonitor_RecordWorkerHealth (0.00s)
=== RUN   TestPerformanceMonitor_GetPerformanceReport
{"level":"warn","timestamp":"2025-12-24T08:43:34.264+0700","caller":"logging/logger.go:212","msg":"Failed to get Redis info","error":"ERR wrong number of arguments for 'info' command"}
--- PASS: TestPerformanceMonitor_GetPerformanceReport (0.00s)
=== RUN   TestPerformanceMonitor_CalculateHealthScore
--- PASS: TestPerformanceMonitor_CalculateHealthScore (0.00s)
=== RUN   TestPerformanceMonitor_ConcurrentAccess
--- PASS: TestPerformanceMonitor_ConcurrentAccess (0.00s)
=== RUN   TestPerformanceMonitor_CacheMetrics
{"level":"warn","timestamp":"2025-12-24T08:43:34.268+0700","caller":"logging/logger.go:212","msg":"Failed to get Redis info","error":"ERR wrong number of arguments for 'info' command"}
--- PASS: TestPerformanceMonitor_CacheMetrics (0.00s)
=== RUN   TestPerformanceMonitor_CollectSystemMetrics
--- PASS: TestPerformanceMonitor_CollectSystemMetrics (0.00s)
=== RUN   TestPerformanceMonitor_CollectRedisMetrics
{"level":"warn","timestamp":"2025-12-24T08:43:34.269+0700","caller":"logging/logger.go:212","msg":"Failed to get Redis info","error":"ERR wrong number of arguments for 'info' command"}
--- PASS: TestPerformanceMonitor_CollectRedisMetrics (0.00s)
=== RUN   TestPerformanceMonitor_WithNilRedis
--- PASS: TestPerformanceMonitor_WithNilRedis (0.00s)
=== RUN   TestNewResourceManager
--- PASS: TestNewResourceManager (0.00s)
=== RUN   TestResourceManager_RegisterResource
--- PASS: TestResourceManager_RegisterResource (0.00s)
=== RUN   TestResourceManager_UpdateResourceUsage
--- PASS: TestResourceManager_UpdateResourceUsage (0.01s)
=== RUN   TestResourceManager_CleanupResource
--- PASS: TestResourceManager_CleanupResource (0.00s)
=== RUN   TestResourceManager_CleanupResourceWithError
{"level":"error","timestamp":"2025-12-24T08:43:34.280+0700","caller":"logging/logger.go:221","msg":"Resource cleanup failed","resource_id":"test-resource","resource_type":"channel","error":"assert.AnError general error for testing","stacktrace":"github.com/irfandi/celebrum-ai-go/internal/logging.(*StandardLogger).Error\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/logging/logger.go:221\ngithub.com/irfandi/celebrum-ai-go/internal/services.(*ResourceManager).CleanupResource\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/resource_manager.go:195\ngithub.com/irfandi/celebrum-ai-go/internal/services.TestResourceManager_CleanupResourceWithError\n\t/Users/irfandi/conductor/workspaces/celebrum-ai-go/santo/services/backend-api/internal/services/resource_manager_test.go:143\ntesting.tRunner\n\t/opt/homebrew/Cellar/go/1.25.5/libexec/src/testing/testing.go:1934"}
--- PASS: TestResourceManager_CleanupResourceWithError (0.00s)
=== RUN   TestResourceManager_CleanupResource_NonExistent
--- PASS: TestResourceManager_CleanupResource_NonExistent (0.00s)
=== RUN   TestResourceManager_CleanupIdleResources
{"level":"info","timestamp":"2025-12-24T08:43:34.301+0700","caller":"logging/logger.go:203","msg":"Idle resource cleaned up","resource_id":"idle-resource","resource_type":"connection","idle_time":0.021035167}
{"level":"info","timestamp":"2025-12-24T08:43:34.301+0700","caller":"logging/logger.go:203","msg":"Idle resource cleanup completed","cleaned_count":1}
--- PASS: TestResourceManager_CleanupIdleResources (0.02s)
=== RUN   TestResourceManager_DetectLeaks
--- PASS: TestResourceManager_DetectLeaks (0.05s)
=== RUN   TestResourceManager_GetResourceStats
--- PASS: TestResourceManager_GetResourceStats (0.00s)
=== RUN   TestResourceManager_GetSystemStats
--- PASS: TestResourceManager_GetSystemStats (0.00s)
=== RUN   TestResourceManager_CleanupAll
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Cleaning up all managed resources"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"All managed resources cleaned up"}
--- PASS: TestResourceManager_CleanupAll (0.00s)
=== RUN   TestResourceManager_Shutdown
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Shutting down resource manager"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Cleaning up all managed resources"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"All managed resources cleaned up"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Resource manager shutdown complete"}
--- PASS: TestResourceManager_Shutdown (0.00s)
=== RUN   TestResourceManager_SetConfiguration
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Shutting down resource manager"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Cleaning up all managed resources"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"All managed resources cleaned up"}
{"level":"info","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:203","msg":"Resource manager shutdown complete"}
--- PASS: TestResourceManager_SetConfiguration (0.00s)
=== RUN   TestResourceManager_GetResourceCount
--- PASS: TestResourceManager_GetResourceCount (0.00s)
=== RUN   TestResourceManager_IsResourceManaged
--- PASS: TestResourceManager_IsResourceManaged (0.00s)
=== RUN   TestResourceManager_ConcurrentAccess
--- PASS: TestResourceManager_ConcurrentAccess (0.00s)
=== RUN   TestResourceManager_ResourceLimits
{"level":"warn","timestamp":"2025-12-24T08:43:34.353+0700","caller":"logging/logger.go:212","msg":"High resource count detected","resource_count":11}
--- PASS: TestResourceManager_ResourceLimits (0.00s)
=== RUN   TestResourceManager_MetadataHandling
--- PASS: TestResourceManager_MetadataHandling (0.00s)
=== RUN   TestResourceManager_ResourceAging
    resource_manager_test.go:515: Original LastUsed: 2025-12-24 08:43:34.353804 +0700 WIB m=+10.558217751
    resource_manager_test.go:516: Updated LastUsed: 2025-12-24 08:43:34.404844 +0700 WIB m=+10.609257292
    resource_manager_test.go:517: Time difference: 51.039541ms
--- PASS: TestResourceManager_ResourceAging (0.05s)
=== RUN   TestNewResourceOptimizer
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
--- PASS: TestNewResourceOptimizer (0.00s)
=== RUN   TestNewResourceOptimizer_WithDefaults
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestNewResourceOptimizer_WithDefaults (0.00s)
=== RUN   TestResourceOptimizer_calculateOptimalConcurrency
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
--- PASS: TestResourceOptimizer_calculateOptimalConcurrency (0.00s)
=== RUN   TestResourceOptimizer_calculateOptimalConcurrency_HighLoad
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=11 max_concurrent_symbols=11 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=22
--- PASS: TestResourceOptimizer_calculateOptimalConcurrency_HighLoad (0.00s)
=== RUN   TestResourceOptimizer_calculateOptimalConcurrency_LowMemory
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=8 max_concurrent_symbols=8 max_concurrent_backfill=4 max_concurrent_writes=2 max_circuit_breaker_calls=16
--- PASS: TestResourceOptimizer_calculateOptimalConcurrency_LowMemory (0.00s)
=== RUN   TestResourceOptimizer_GetOptimalConcurrency
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=10 max_concurrent_symbols=10 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=20
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=10 max_concurrent_symbols=10 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=20
--- PASS: TestResourceOptimizer_GetOptimalConcurrency (0.00s)
=== RUN   TestResourceOptimizer_UpdateSystemMetrics
2025/12/24 08:43:34 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:34 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_UpdateSystemMetrics (1.00s)
=== RUN   TestResourceOptimizer_UpdateSystemMetrics_WithMockData
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_UpdateSystemMetrics_WithMockData (0.00s)
=== RUN   TestResourceOptimizer_RecordPerformanceSnapshot
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_RecordPerformanceSnapshot (0.00s)
=== RUN   TestResourceOptimizer_OptimizeIfNeeded_RegularInterval
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=10 max_concurrent_symbols=10 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=20
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:35 INFO Regular optimization triggered interval=100ms
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=10 max_concurrent_symbols=10 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=20
--- PASS: TestResourceOptimizer_OptimizeIfNeeded_RegularInterval (0.00s)
=== RUN   TestResourceOptimizer_OptimizeIfNeeded_AdaptiveMode
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=10 max_concurrent_symbols=10 max_concurrent_backfill=5 max_concurrent_writes=3 max_circuit_breaker_calls=20
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
    resource_optimizer_test.go:233: Should optimize result: true
2025/12/24 08:43:35 INFO Adaptive optimization triggered due to performance changes
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=7 max_concurrent_symbols=7 max_concurrent_backfill=3 max_concurrent_writes=2 max_circuit_breaker_calls=14
    resource_optimizer_test.go:237: Optimization result: true
--- PASS: TestResourceOptimizer_OptimizeIfNeeded_AdaptiveMode (0.00s)
=== RUN   TestResourceOptimizer_shouldOptimize
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_shouldOptimize (0.00s)
=== RUN   TestResourceOptimizer_GetPerformanceHistory
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_GetPerformanceHistory (0.00s)
=== RUN   TestResourceOptimizer_GetSystemInfo
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_GetSystemInfo (0.00s)
=== RUN   TestResourceOptimizer_ConcurrentAccess
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
--- PASS: TestResourceOptimizer_ConcurrentAccess (0.05s)
=== RUN   TestResourceOptimizer_min
--- PASS: TestResourceOptimizer_min (0.00s)
=== RUN   TestResourceOptimizer_Configuration
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=true
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
--- PASS: TestResourceOptimizer_Configuration (0.00s)
=== RUN   TestResourceOptimizer_PerformanceSnapshot_Timestamp
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
--- PASS: TestResourceOptimizer_PerformanceSnapshot_Timestamp (0.00s)
=== RUN   TestResourceOptimizer_OptimizationTiming
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=16 max_concurrent_symbols=16 max_concurrent_backfill=8 max_concurrent_writes=5 max_circuit_breaker_calls=32
2025/12/24 08:43:35 INFO Resource Optimizer initialized cpu_cores=8 memory_gb=8 adaptive_mode=false
2025/12/24 08:43:35 INFO Regular optimization triggered interval=50ms
2025/12/24 08:43:35 INFO Calculated optimal concurrency max_workers=0 max_concurrent_symbols=0 max_concurrent_backfill=0 max_concurrent_writes=0 max_circuit_breaker_calls=0
--- PASS: TestResourceOptimizer_OptimizationTiming (0.06s)
=== RUN   TestSignalAggregationIntegration
=== RUN   TestSignalAggregationIntegration/SignalProcessingPipeline
    signal_aggregation_integration_test.go:42: Database-dependent test - requires proper setup
=== RUN   TestSignalAggregationIntegration/SignalQualityAssessment
    signal_aggregation_integration_test.go:61: Quality assessment test - requires proper service setup
=== RUN   TestSignalAggregationIntegration/SignalAggregation
    signal_aggregation_integration_test.go:116: Signal aggregation test - requires proper service setup
=== RUN   TestSignalAggregationIntegration/CircuitBreakerIntegration
    signal_aggregation_integration_test.go:138: Circuit breaker test - requires proper service setup
=== RUN   TestSignalAggregationIntegration/ErrorHandlingAndRecovery
    signal_aggregation_integration_test.go:158: Error handling test - requires proper service setup
=== RUN   TestSignalAggregationIntegration/EndToEndPipeline
    signal_aggregation_integration_test.go:176: End-to-end pipeline test - requires proper service setup
--- PASS: TestSignalAggregationIntegration (0.00s)
    --- SKIP: TestSignalAggregationIntegration/SignalProcessingPipeline (0.00s)
    --- SKIP: TestSignalAggregationIntegration/SignalQualityAssessment (0.00s)
    --- SKIP: TestSignalAggregationIntegration/SignalAggregation (0.00s)
    --- SKIP: TestSignalAggregationIntegration/CircuitBreakerIntegration (0.00s)
    --- SKIP: TestSignalAggregationIntegration/ErrorHandlingAndRecovery (0.00s)
    --- SKIP: TestSignalAggregationIntegration/EndToEndPipeline (0.00s)
=== RUN   TestSignalAggregator_Interface
--- PASS: TestSignalAggregator_Interface (0.00s)
=== RUN   TestSignalAggregator_QualityAssessment
--- PASS: TestSignalAggregator_QualityAssessment (0.00s)
=== RUN   TestSignalAggregator_BasicFunctionality
--- PASS: TestSignalAggregator_BasicFunctionality (0.00s)
=== RUN   TestSignalAggregator_SignalStrengthCalculation
=== RUN   TestSignalAggregator_SignalStrengthCalculation/Weak_signal_-_low_confidence
=== RUN   TestSignalAggregator_SignalStrengthCalculation/Weak_signal_-_low_profit
=== RUN   TestSignalAggregator_SignalStrengthCalculation/Medium_signal
=== RUN   TestSignalAggregator_SignalStrengthCalculation/Strong_signal
--- PASS: TestSignalAggregator_SignalStrengthCalculation (0.00s)
    --- PASS: TestSignalAggregator_SignalStrengthCalculation/Weak_signal_-_low_confidence (0.00s)
    --- PASS: TestSignalAggregator_SignalStrengthCalculation/Weak_signal_-_low_profit (0.00s)
    --- PASS: TestSignalAggregator_SignalStrengthCalculation/Medium_signal (0.00s)
    --- PASS: TestSignalAggregator_SignalStrengthCalculation/Strong_signal (0.00s)
=== RUN   TestSignalAggregator_PriceRangeCalculation
--- PASS: TestSignalAggregator_PriceRangeCalculation (0.00s)
=== RUN   TestSignalAggregator_ErrorScenarios
--- PASS: TestSignalAggregator_ErrorScenarios (0.00s)
=== RUN   TestSignalAggregator_ConcurrentSafety
--- PASS: TestSignalAggregator_ConcurrentSafety (0.00s)
=== RUN   TestSignalAggregator_NewSignalAggregator
--- PASS: TestSignalAggregator_NewSignalAggregator (0.00s)
=== RUN   TestSignalAggregator_AggregateArbitrageSignals_Basic
{"level":"info","timestamp":"2025-12-24T08:43:35.519+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage signal aggregation","input_count":2,"min_volume":"10000","base_amount":"20000","operation_type":"signal_aggregation","signal_type":"arbitrage"}
{"level":"info","timestamp":"2025-12-24T08:43:35.519+0700","caller":"logging/logger.go:203","msg":"Aggregating arbitrage signals with enhanced price ranges"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Arbitrage signal aggregation completed","signals_generated":1,"symbols_processed":1,"operation_result":"success"}
--- PASS: TestSignalAggregator_AggregateArbitrageSignals_Basic (0.00s)
=== RUN   TestSignalAggregator_AggregateArbitrageSignals_EmptyInput
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage signal aggregation","min_volume":"10000","base_amount":"20000","operation_type":"signal_aggregation","signal_type":"arbitrage","input_count":0}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Aggregating arbitrage signals with enhanced price ranges"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Arbitrage signal aggregation completed","signals_generated":0,"symbols_processed":0,"operation_result":"success"}
--- PASS: TestSignalAggregator_AggregateArbitrageSignals_EmptyInput (0.00s)
=== RUN   TestSignalAggregator_AggregateArbitrageSignals_LowProfit
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage signal aggregation","operation_type":"signal_aggregation","signal_type":"arbitrage","input_count":1,"min_volume":"10000","base_amount":"20000"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Aggregating arbitrage signals with enhanced price ranges"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Arbitrage signal aggregation completed","signals_generated":0,"symbols_processed":1,"operation_result":"success"}
--- PASS: TestSignalAggregator_AggregateArbitrageSignals_LowProfit (0.00s)
=== RUN   TestSignalAggregator_AggregateArbitrageSignals_QualityFilter
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage signal aggregation","operation_type":"signal_aggregation","signal_type":"arbitrage","input_count":1,"min_volume":"10000","base_amount":"20000"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Aggregating arbitrage signals with enhanced price ranges"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Assessing signal quality","signal_type":"arbitrage","symbol":"BTC/USDT","exchanges":["1","2"]}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Refreshing exchange reliability cache"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Exchange reliability cache refreshed","exchanges_cached":3}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Arbitrage signal aggregation completed","symbols_processed":1,"operation_result":"success","signals_generated":0}
--- PASS: TestSignalAggregator_AggregateArbitrageSignals_QualityFilter (0.00s)
=== RUN   TestSignalAggregator_AggregateArbitrageSignals_MultipleOpportunities
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Starting arbitrage signal aggregation","input_count":3,"min_volume":"10000","base_amount":"20000","operation_type":"signal_aggregation","signal_type":"arbitrage"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Aggregating arbitrage signals with enhanced price ranges"}
{"level":"info","timestamp":"2025-12-24T08:43:35.520+0700","caller":"logging/logger.go:203","msg":"Arbitrage signal aggregation completed","signals_generated":1,"symbols_processed":1,"operation_result":"success"}
--- PASS: TestSignalAggregator_AggregateArbitrageSignals_MultipleOpportunities (0.00s)
=== RUN   TestSignalProcessor_ProcessSignal
    signal_processor_custom_test.go:117: there were unfulfilled expectations: there is a remaining expectation which was not matched: ExpectedQuery => expecting call to Query() or to QueryRow():
        	- matches sql: 'SELECT name FROM exchanges WHERE id = \$1'
        	- is with arguments:
        		0 - 1
        	- returns data:
        		row 0 - [binance]
        
--- FAIL: TestSignalProcessor_ProcessSignal (0.00s)
=== RUN   TestSignalProcessor_GetRecentMarketDataFromDB_Success
--- PASS: TestSignalProcessor_GetRecentMarketDataFromDB_Success (0.00s)
=== RUN   TestSignalProcessor_GetRecentMarketDataFromDB_MissingVolume24hColumn
--- PASS: TestSignalProcessor_GetRecentMarketDataFromDB_MissingVolume24hColumn (0.00s)
=== RUN   TestSignalProcessor_GetRecentMarketDataFromDB_QueryError
--- PASS: TestSignalProcessor_GetRecentMarketDataFromDB_QueryError (0.00s)
=== RUN   TestSignalProcessor_GetRecentMarketDataFromDB_EmptyResult
--- PASS: TestSignalProcessor_GetRecentMarketDataFromDB_EmptyResult (0.00s)
=== RUN   TestSignalProcessor_GetRecentMarketDataFromDB_ScanError
--- PASS: TestSignalProcessor_GetRecentMarketDataFromDB_ScanError (0.00s)
=== RUN   TestSignalProcessor_GetTradingPairSymbol_Success
--- PASS: TestSignalProcessor_GetTradingPairSymbol_Success (0.00s)
=== RUN   TestSignalProcessor_GetTradingPairSymbol_NotFound
--- PASS: TestSignalProcessor_GetTradingPairSymbol_NotFound (0.00s)
=== RUN   TestSignalProcessor_GetTradingPairSymbol_DBError
--- PASS: TestSignalProcessor_GetTradingPairSymbol_DBError (0.00s)
=== RUN   TestSignalProcessor_Config
--- PASS: TestSignalProcessor_Config (0.00s)
=== RUN   TestSignalProcessor_ProcessingMetrics
--- PASS: TestSignalProcessor_ProcessingMetrics (0.00s)
=== RUN   TestSignalProcessor_CircuitBreakerStates
--- PASS: TestSignalProcessor_CircuitBreakerStates (0.00s)
=== RUN   TestSignalProcessor_SignalStrengthMapping
--- PASS: TestSignalProcessor_SignalStrengthMapping (0.00s)
=== RUN   TestSignalProcessor_SignalTypeMapping
--- PASS: TestSignalProcessor_SignalTypeMapping (0.00s)
=== RUN   TestSignalProcessor_ContextHandling
--- PASS: TestSignalProcessor_ContextHandling (0.00s)
=== RUN   TestSignalProcessor_TimeHandling
--- PASS: TestSignalProcessor_TimeHandling (0.00s)
=== RUN   TestSignalProcessor_ValidationMethods
--- PASS: TestSignalProcessor_ValidationMethods (0.00s)
=== RUN   TestSignalProcessor_LoggerInterface
--- PASS: TestSignalProcessor_LoggerInterface (0.00s)
=== RUN   TestSignalProcessor_ErrorScenarios
--- PASS: TestSignalProcessor_ErrorScenarios (0.00s)
=== RUN   TestSignalProcessor_ConcurrentSafety
--- PASS: TestSignalProcessor_ConcurrentSafety (0.00s)
=== RUN   TestNewSignalQualityScorer
--- PASS: TestNewSignalQualityScorer (0.00s)
=== RUN   TestGetDefaultQualityThresholds
--- PASS: TestGetDefaultQualityThresholds (0.00s)
=== RUN   TestAssessSignalQuality
--- PASS: TestAssessSignalQuality (0.00s)
=== RUN   TestIsSignalQualityAcceptable
=== RUN   TestIsSignalQualityAcceptable/High_quality_signal
=== RUN   TestIsSignalQualityAcceptable/Low_overall_score
=== RUN   TestIsSignalQualityAcceptable/High_risk_score
--- PASS: TestIsSignalQualityAcceptable (0.00s)
    --- PASS: TestIsSignalQualityAcceptable/High_quality_signal (0.00s)
    --- PASS: TestIsSignalQualityAcceptable/Low_overall_score (0.00s)
    --- PASS: TestIsSignalQualityAcceptable/High_risk_score (0.00s)
=== RUN   TestCalculateExchangeScore
=== RUN   TestCalculateExchangeScore/No_exchanges
=== RUN   TestCalculateExchangeScore/Single_known_exchange
=== RUN   TestCalculateExchangeScore/Multiple_known_exchanges
=== RUN   TestCalculateExchangeScore/Unknown_exchange
--- PASS: TestCalculateExchangeScore (0.00s)
    --- PASS: TestCalculateExchangeScore/No_exchanges (0.00s)
    --- PASS: TestCalculateExchangeScore/Single_known_exchange (0.00s)
    --- PASS: TestCalculateExchangeScore/Multiple_known_exchanges (0.00s)
    --- PASS: TestCalculateExchangeScore/Unknown_exchange (0.00s)
=== RUN   TestCalculateVolumeScore
=== RUN   TestCalculateVolumeScore/Zero_volume
=== RUN   TestCalculateVolumeScore/Very_low_volume
=== RUN   TestCalculateVolumeScore/Medium_volume
=== RUN   TestCalculateVolumeScore/High_volume
=== RUN   TestCalculateVolumeScore/Excellent_volume
--- PASS: TestCalculateVolumeScore (0.00s)
    --- PASS: TestCalculateVolumeScore/Zero_volume (0.00s)
    --- PASS: TestCalculateVolumeScore/Very_low_volume (0.00s)
    --- PASS: TestCalculateVolumeScore/Medium_volume (0.00s)
    --- PASS: TestCalculateVolumeScore/High_volume (0.00s)
    --- PASS: TestCalculateVolumeScore/Excellent_volume (0.00s)
=== RUN   TestCalculateLiquidityScore
=== RUN   TestCalculateLiquidityScore/No_market_data
=== RUN   TestCalculateLiquidityScore/Good_liquidity
=== RUN   TestCalculateLiquidityScore/Poor_liquidity
--- PASS: TestCalculateLiquidityScore (0.00s)
    --- PASS: TestCalculateLiquidityScore/No_market_data (0.00s)
    --- PASS: TestCalculateLiquidityScore/Good_liquidity (0.00s)
    --- PASS: TestCalculateLiquidityScore/Poor_liquidity (0.00s)
=== RUN   TestCalculateVolatilityScore
=== RUN   TestCalculateVolatilityScore/No_market_data
=== RUN   TestCalculateVolatilityScore/Very_low_volatility
=== RUN   TestCalculateVolatilityScore/Optimal_volatility
=== RUN   TestCalculateVolatilityScore/High_volatility
=== RUN   TestCalculateVolatilityScore/Extreme_volatility
--- PASS: TestCalculateVolatilityScore (0.00s)
    --- PASS: TestCalculateVolatilityScore/No_market_data (0.00s)
    --- PASS: TestCalculateVolatilityScore/Very_low_volatility (0.00s)
    --- PASS: TestCalculateVolatilityScore/Optimal_volatility (0.00s)
    --- PASS: TestCalculateVolatilityScore/High_volatility (0.00s)
    --- PASS: TestCalculateVolatilityScore/Extreme_volatility (0.00s)
=== RUN   TestCalculateTimingScore
=== RUN   TestCalculateTimingScore/Very_fresh_signal
=== RUN   TestCalculateTimingScore/Fresh_signal
=== RUN   TestCalculateTimingScore/Acceptable_signal
=== RUN   TestCalculateTimingScore/Getting_stale
=== RUN   TestCalculateTimingScore/Stale_signal
=== RUN   TestCalculateTimingScore/Very_stale_signal
--- PASS: TestCalculateTimingScore (0.00s)
    --- PASS: TestCalculateTimingScore/Very_fresh_signal (0.00s)
    --- PASS: TestCalculateTimingScore/Fresh_signal (0.00s)
    --- PASS: TestCalculateTimingScore/Acceptable_signal (0.00s)
    --- PASS: TestCalculateTimingScore/Getting_stale (0.00s)
    --- PASS: TestCalculateTimingScore/Stale_signal (0.00s)
    --- PASS: TestCalculateTimingScore/Very_stale_signal (0.00s)
=== RUN   TestSignalQualityCalculateRiskScore
--- PASS: TestSignalQualityCalculateRiskScore (0.00s)
=== RUN   TestCalculateDataFreshnessScore
=== RUN   TestCalculateDataFreshnessScore/Very_fresh_data
=== RUN   TestCalculateDataFreshnessScore/Fresh_data
=== RUN   TestCalculateDataFreshnessScore/Acceptable_data
=== RUN   TestCalculateDataFreshnessScore/Stale_data
=== RUN   TestCalculateDataFreshnessScore/Very_stale_data
--- PASS: TestCalculateDataFreshnessScore (0.00s)
    --- PASS: TestCalculateDataFreshnessScore/Very_fresh_data (0.00s)
    --- PASS: TestCalculateDataFreshnessScore/Fresh_data (0.00s)
    --- PASS: TestCalculateDataFreshnessScore/Acceptable_data (0.00s)
    --- PASS: TestCalculateDataFreshnessScore/Stale_data (0.00s)
    --- PASS: TestCalculateDataFreshnessScore/Very_stale_data (0.00s)
=== RUN   TestCalculateMarketConditionScore
=== RUN   TestCalculateMarketConditionScore/Very_stable_market
=== RUN   TestCalculateMarketConditionScore/Good_stability
=== RUN   TestCalculateMarketConditionScore/Optimal_movement
=== RUN   TestCalculateMarketConditionScore/High_volatility
=== RUN   TestCalculateMarketConditionScore/Extreme_volatility
--- PASS: TestCalculateMarketConditionScore (0.00s)
    --- PASS: TestCalculateMarketConditionScore/Very_stable_market (0.00s)
    --- PASS: TestCalculateMarketConditionScore/Good_stability (0.00s)
    --- PASS: TestCalculateMarketConditionScore/Optimal_movement (0.00s)
    --- PASS: TestCalculateMarketConditionScore/High_volatility (0.00s)
    --- PASS: TestCalculateMarketConditionScore/Extreme_volatility (0.00s)
=== RUN   TestAssessOrderBookDepth
=== RUN   TestAssessOrderBookDepth/Very_low_depth
=== RUN   TestAssessOrderBookDepth/Medium_depth
=== RUN   TestAssessOrderBookDepth/Good_depth
=== RUN   TestAssessOrderBookDepth/Excellent_depth
--- PASS: TestAssessOrderBookDepth (0.00s)
    --- PASS: TestAssessOrderBookDepth/Very_low_depth (0.00s)
    --- PASS: TestAssessOrderBookDepth/Medium_depth (0.00s)
    --- PASS: TestAssessOrderBookDepth/Good_depth (0.00s)
    --- PASS: TestAssessOrderBookDepth/Excellent_depth (0.00s)
=== RUN   TestAssessSpread
=== RUN   TestAssessSpread/Excellent_spread
=== RUN   TestAssessSpread/Good_spread
=== RUN   TestAssessSpread/Acceptable_spread
=== RUN   TestAssessSpread/Poor_spread
=== RUN   TestAssessSpread/Very_poor_spread
--- PASS: TestAssessSpread (0.00s)
    --- PASS: TestAssessSpread/Excellent_spread (0.00s)
    --- PASS: TestAssessSpread/Good_spread (0.00s)
    --- PASS: TestAssessSpread/Acceptable_spread (0.00s)
    --- PASS: TestAssessSpread/Poor_spread (0.00s)
    --- PASS: TestAssessSpread/Very_poor_spread (0.00s)
=== RUN   TestExchangeReliabilityCache
--- PASS: TestExchangeReliabilityCache (0.00s)
=== RUN   TestCalculateExchangeReliability
--- PASS: TestCalculateExchangeReliability (0.00s)
=== RUN   TestNewTechnicalAnalysisService
--- PASS: TestNewTechnicalAnalysisService (0.00s)
=== RUN   TestGetDefaultIndicatorConfig
--- PASS: TestGetDefaultIndicatorConfig (0.00s)
=== RUN   TestCalculateSMA
    technical_analysis_test.go:153: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateSMA (0.00s)
=== RUN   TestCalculateEMA
    technical_analysis_test.go:200: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateEMA (0.00s)
=== RUN   TestCalculateRSI
    technical_analysis_test.go:216: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateRSI (0.00s)
=== RUN   TestCalculateMACD
    technical_analysis_test.go:256: Skipping due to hangs in github.com/cinar/indicator/v2 MACD implementation
--- SKIP: TestCalculateMACD (0.00s)
=== RUN   TestCalculateBollingerBands
    technical_analysis_test.go:274: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateBollingerBands (0.00s)
=== RUN   TestCalculateATR
    technical_analysis_test.go:292: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateATR (0.00s)
=== RUN   TestCalculateStochastic
    technical_analysis_test.go:317: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateStochastic (0.00s)
=== RUN   TestCalculateOBV
    technical_analysis_test.go:342: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateOBV (0.00s)
=== RUN   TestAnalyzeSMASignal
=== RUN   TestAnalyzeSMASignal/Price_crossing_above_SMA
=== RUN   TestAnalyzeSMASignal/Price_crossing_below_SMA
=== RUN   TestAnalyzeSMASignal/Price_above_SMA
=== RUN   TestAnalyzeSMASignal/Price_below_SMA
--- PASS: TestAnalyzeSMASignal (0.00s)
    --- PASS: TestAnalyzeSMASignal/Price_crossing_above_SMA (0.00s)
    --- PASS: TestAnalyzeSMASignal/Price_crossing_below_SMA (0.00s)
    --- PASS: TestAnalyzeSMASignal/Price_above_SMA (0.00s)
    --- PASS: TestAnalyzeSMASignal/Price_below_SMA (0.00s)
=== RUN   TestAnalyzeRSISignal
=== RUN   TestAnalyzeRSISignal/Oversold_condition
=== RUN   TestAnalyzeRSISignal/Overbought_condition
=== RUN   TestAnalyzeRSISignal/Neutral_condition
--- PASS: TestAnalyzeRSISignal (0.00s)
    --- PASS: TestAnalyzeRSISignal/Oversold_condition (0.00s)
    --- PASS: TestAnalyzeRSISignal/Overbought_condition (0.00s)
    --- PASS: TestAnalyzeRSISignal/Neutral_condition (0.00s)
=== RUN   TestAnalyzeMACDSignal
=== RUN   TestAnalyzeMACDSignal/MACD_crossing_above_zero
=== RUN   TestAnalyzeMACDSignal/MACD_crossing_below_zero
=== RUN   TestAnalyzeMACDSignal/MACD_above_zero
=== RUN   TestAnalyzeMACDSignal/MACD_below_zero
--- PASS: TestAnalyzeMACDSignal (0.00s)
    --- PASS: TestAnalyzeMACDSignal/MACD_crossing_above_zero (0.00s)
    --- PASS: TestAnalyzeMACDSignal/MACD_crossing_below_zero (0.00s)
    --- PASS: TestAnalyzeMACDSignal/MACD_above_zero (0.00s)
    --- PASS: TestAnalyzeMACDSignal/MACD_below_zero (0.00s)
=== RUN   TestDetermineOverallSignal
=== RUN   TestDetermineOverallSignal/Strong_buy_signals
=== RUN   TestDetermineOverallSignal/Strong_sell_signals
=== RUN   TestDetermineOverallSignal/Mixed_signals
=== RUN   TestDetermineOverallSignal/No_indicators
--- PASS: TestDetermineOverallSignal (0.00s)
    --- PASS: TestDetermineOverallSignal/Strong_buy_signals (0.00s)
    --- PASS: TestDetermineOverallSignal/Strong_sell_signals (0.00s)
    --- PASS: TestDetermineOverallSignal/Mixed_signals (0.00s)
    --- PASS: TestDetermineOverallSignal/No_indicators (0.00s)
=== RUN   TestConvertToSnapshots
--- PASS: TestConvertToSnapshots (0.00s)
=== RUN   TestCalculateAllIndicators
    technical_analysis_test.go:555: Skipping due to hangs in MACD calculation
--- SKIP: TestCalculateAllIndicators (0.00s)
=== RUN   TestCalculateIndicatorsWithInsufficientData
    technical_analysis_test.go:642: Skipping due to goroutine leaks in github.com/cinar/indicator/v2 library
--- SKIP: TestCalculateIndicatorsWithInsufficientData (0.00s)
=== RUN   TestAnalyzeSignalsWithEmptyData
--- PASS: TestAnalyzeSignalsWithEmptyData (0.00s)
=== RUN   TestTimeoutManager_NewTimeoutManager
--- PASS: TestTimeoutManager_NewTimeoutManager (0.00s)
=== RUN   TestTimeoutManager_DefaultTimeoutConfig
--- PASS: TestTimeoutManager_DefaultTimeoutConfig (0.00s)
=== RUN   TestTimeoutManager_CreateOperationContext
--- PASS: TestTimeoutManager_CreateOperationContext (0.00s)
=== RUN   TestTimeoutManager_CreateOperationContextWithParent
--- PASS: TestTimeoutManager_CreateOperationContextWithParent (0.00s)
=== RUN   TestTimeoutManager_CreateOperationContextWithCustomTimeout
--- PASS: TestTimeoutManager_CreateOperationContextWithCustomTimeout (0.00s)
=== RUN   TestTimeoutManager_CompleteOperation
--- PASS: TestTimeoutManager_CompleteOperation (0.00s)
=== RUN   TestTimeoutManager_CancelOperation
{"level":"info","timestamp":"2025-12-24T08:43:35.524+0700","caller":"logging/logger.go:203","msg":"Operation cancelled","operation_id":"op1"}
--- PASS: TestTimeoutManager_CancelOperation (0.00s)
=== RUN   TestTimeoutManager_CancelAllOperations
{"level":"info","timestamp":"2025-12-24T08:43:35.524+0700","caller":"logging/logger.go:203","msg":"Operation cancelled during shutdown","operation_id":"op1"}
{"level":"info","timestamp":"2025-12-24T08:43:35.524+0700","caller":"logging/logger.go:203","msg":"Operation cancelled during shutdown","operation_id":"op2"}
--- PASS: TestTimeoutManager_CancelAllOperations (0.00s)
=== RUN   TestTimeoutManager_GetActiveOperationCount
--- PASS: TestTimeoutManager_GetActiveOperationCount (0.00s)
=== RUN   TestTimeoutManager_GetActiveOperations
--- PASS: TestTimeoutManager_GetActiveOperations (0.00s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout
--- PASS: TestTimeoutManager_ExecuteWithTimeout (0.00s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_Success
--- PASS: TestTimeoutManager_ExecuteWithTimeout_Success (0.00s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_Timeout
--- PASS: TestTimeoutManager_ExecuteWithTimeout_Timeout (0.10s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_OperationError
--- PASS: TestTimeoutManager_ExecuteWithTimeout_OperationError (0.00s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_ContextCancellation
--- PASS: TestTimeoutManager_ExecuteWithTimeout_ContextCancellation (0.10s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/api_call
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/database_query
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/redis_operation
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/concurrent_op
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/health_check
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/backfill
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/symbol_fetch
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/market_data
=== RUN   TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/unknown_type
--- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/api_call (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/database_query (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/redis_operation (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/concurrent_op (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/health_check (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/backfill (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/symbol_fetch (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/market_data (0.00s)
    --- PASS: TestTimeoutManager_ExecuteWithTimeout_DifferentOperationTypes/unknown_type (0.00s)
=== RUN   TestTimeoutManager_ExecuteWithTimeout_ConcurrentOperations
--- PASS: TestTimeoutManager_ExecuteWithTimeout_ConcurrentOperations (0.01s)
=== RUN   TestTimeoutManager_ExecuteWithTimeoutAndFallback
--- PASS: TestTimeoutManager_ExecuteWithTimeoutAndFallback (0.00s)
=== RUN   TestTimeoutManager_MonitorOperationHealth
--- PASS: TestTimeoutManager_MonitorOperationHealth (0.01s)
=== RUN   TestTimeoutManager_UpdateTimeoutConfig
{"level":"info","timestamp":"2025-12-24T08:43:35.746+0700","caller":"logging/logger.go:203","msg":"Timeout configuration updated"}
--- PASS: TestTimeoutManager_UpdateTimeoutConfig (0.00s)
=== RUN   TestTimeoutManager_IsOperationActive
--- PASS: TestTimeoutManager_IsOperationActive (0.00s)
=== RUN   TestTimeoutManager_GetOperationStats
--- PASS: TestTimeoutManager_GetOperationStats (0.00s)
=== RUN   TestTimeoutManager_Shutdown
{"level":"info","timestamp":"2025-12-24T08:43:35.746+0700","caller":"logging/logger.go:203","msg":"Shutting down timeout manager"}
{"level":"info","timestamp":"2025-12-24T08:43:35.746+0700","caller":"logging/logger.go:203","msg":"Operation cancelled during shutdown","operation_id":"op1"}
{"level":"info","timestamp":"2025-12-24T08:43:35.746+0700","caller":"logging/logger.go:203","msg":"Timeout manager shutdown complete"}
--- PASS: TestTimeoutManager_Shutdown (0.00s)
FAIL
FAIL	github.com/irfandi/celebrum-ai-go/internal/services	12.357s
FAIL
